<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why doesn't the New Folder command work in the root of a redirected drive resource in a Remote Desktop session?</h1>  <!-- .entry-meta -->

<p>When you connect to another computer via Remote Desktop, you have the option of injecting your local drives into the remote computer, known as <a href="http://technet.microsoft.com/en-us/library/cc725887%28v=WS.10%29.aspx"> Device and Resource Redirection</a>. These injected drives are available under the UNC <code>\\tsclient\X</code> where X is a drive letter on the local machine.
 The name <code>TSCLIENT</code> combines a bunch of internal technical terminology, so it makes perfect sense to the people who wrote it, but not as much to outsiders. (They may have chosen this name <a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/04/26/120193.aspx"> just to make themselves look smart</a>.) The letters TS stand for Terminal Services, which was the former name of the technology now known as Remote Desktop. And the word <i>client</i> refers to the local computer, the one that is connected to the remote computer. In Terminal Services terminology, the machine you are connect from is the client, and the machine you are connecting to is the server.
 There’s another level of confusion in the name of the feature. People often call these <code>\\tsclient\X</code> thingies <i>Redirected Drives</i>, which collides with the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms685143%28v=vs.85%29.aspx"> existing name</a> for local drive letters that have been mapped to a network resource. In the user interface, these are usually called <i>Mapped Network Drives</i>. From the command line, you create these things via the <code>NET USE</code> command.
 Okay, enough with the confusing terminology. For today, we’re talking about Remote Desktop Device Redirection, where the redirected device is a drive letter.
 If you open <i>My Computer</i> and look under <i>Other</i>, you’ll see those drives which were injected from the local computer. Your first tip-off that there’s something funny about these drives: They don’t show up in the <i>Network Location</i> section like other mapped drives; instead they show up under the rather generic-sounding <i>Other</i>.
 That’s because these drives aren’t really drives. They are <i>folder shortcuts</i>, a special type of shortcut that grafts one part of the shell namespace into another. The ones created by Remote Desktop Device Redirection are <a href="http://msdn.microsoft.com/en-us/library/ms997573.aspx"> <i>shell instance objects</i></a>, which is a way of creating certain types of shell extensions using just a handful of registry keys.
 Since they aren’t really drives, some things that work for real drives don’t work for these fake drives. And one of those things is that Explorer thinks that they don’t support the <i>New Folder</i> command because when Explorer asks, “Do you support <i>IStorage</i>?” (because that’s the interface that Explorer uses to create new folders), the answer is “No, you silly rabbit. I’m an <i>Other</i>!”
 Now, it turns out that the Terminal Services folks could’ve customized their <i>Other</i> to say, “Actually, yeah, I do support <i>IStorage</i>.” You do this by setting the bit <code>0x00000008</code> in the <code>Attributes</code> value of the <code>ShellFolder</code> key when you registered your instance object. The Terminal Services folks forgot to set that bit, and the result is no <i>New Folder</i> button.
 Sorry about that.</p>
<p> As a workaround, you can create your new folder by typing <code>\\tsclient\X</code> into the address bar. That folder is the thing that the folder shortcut is pointing to (so it’s just another name for the same thing), but since it’s the real thing, it correctly reports the <code>SFGAO_STORAGE</code> flag, and the <i>New Folder</i> button appears. </p>


</body>