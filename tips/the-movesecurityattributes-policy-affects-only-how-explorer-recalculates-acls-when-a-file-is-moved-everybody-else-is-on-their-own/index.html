<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">The MoveSecurityAttributes policy affects only how Explorer recalculates ACLs when a file is moved; everybody else is on their own</h1>  <!-- .entry-meta -->

<p>A customer reported that even though they were deploying <a href="http://support.microsoft.com/kb/310316"><code>Move­Security­Attributes</code> policy</a> to all their machines, it wasn’t working everywhere. “It works fine with the GUI but does not work (i.e., has no effect) when using the Move command at the command prompt.” </p>
<p>That’s right. </p>
<p>The <code>Move­Security­Attributes</code> policy <a href="http://blogs.msdn.com/b/oldnewthing/archive/2006/08/24/717181.aspx">applies to Explorer’s file copy engine</a>, the thing that kicks in when you call <code>SHFile­Operation</code> or use the <code>IFile­Operation</code> interface. </p>
<p>The command prompt doesn’t use either of those functions. It just calls the <code>Move­File­Ex</code> function directly. And that function doesn’t respect UI policy because it’s not a UI function. </p>
<p>The KB article does say this when it finishes talking about the default behavior and starts talking about the policy: </p>
<blockquote class="q">
<p>By default… </p>
<p>You can modify <u>how Windows Explorer</u> handles permissions when objects are copied or moved… </p>
</blockquote>
<p>(Emphasis mine.) </p>
<p>The article points out that the technique applies only to Windows Explorer. Mind you, it’s not underlined or anything, so somebody in a hurry is like to miss out on that detail. </p>
<p>So here’s a blog entry to make it more clear. </p>


</body>