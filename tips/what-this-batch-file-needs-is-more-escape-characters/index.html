<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">What this batch file needs is more escape characters</h1>  <!-- .entry-meta -->

<p>
(Employing the snowclone “What this X needs is more Y.”)
</p>
<p>
Each time you add a parsing pass to the batch processor,
you have to
<a href="http://alcor.concordia.ca/~smw/home/telnet_song.html">
add another layer of escaping</a>.
This is just a special case of the more general rule of thumb:
<a href="http://c2.com/cgi/wiki?ButlerLampson">
any problem in quoting can be solved by adding another layer of escaping</a>.
</p>
<p>
(Okay, it’s not actually true, nor is it a rule of thumb,
but it’s still something to keep in mind.)
</p>
<p>
When you enable delayed variable expansion, you add another parsing
pass to the batch processor.
It used to expand % variables at the time the line is ready,
but now you told it that, oh wait, just before executing the
command, expand it a second time (this time looking for ! variables.)
</p>
<p>Which means that
<a href="http://blogs.msdn.com/oldnewthing/archive/2008/08/06/8835317.aspx#8838178">
if you want to echo an exclamation point</a>,
you have to protect the exclamation point so the parser won’t treat
it as a delayed expansion.
</p>
<pre>
echo Error^^!
</pre>
<p>
The <code>^^</code> collapses to a <code>^</code> during the first
parsing pass.
On the second parsing pass, the <code>^!</code> turns into a <code>!</code>
</p>
<p>
Remember,
the batch language was not designed; it evolved.
I admire
<a href="http://blogs.msdn.com/oldnewthing/archive/2008/08/06/8835317.aspx#8839065">
the approach taken by commenter Nick</a>,
in a tip of the hat to Douglas Adams:
</p>
<blockquote class="q"><p>
Much like the universe,
if anyone ever <i>does</i> fully come to understand Batch
then the language will instantly be replaced by an
infinitely weirder and more complex version of itself.
This has obviously happened at least once before 😉
</p></blockquote>


</body>