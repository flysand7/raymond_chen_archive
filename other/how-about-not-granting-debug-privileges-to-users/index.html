<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How about not granting debug privileges to users?</h1>  <!-- .entry-meta -->

<p>Commenter Yuhong Bao suggests, “<a href="http://blogs.msdn.com/oldnewthing/pages/407234.aspx#737720">How about not granting debug privileges on the user? This will make bypassing the protection impossible</a>.”
 This is such a great idea that Windows has worked that way for years.
 Normal non-administrative users do not have debug privilege. <a href="http://msdn.microsoft.com/ms679295.aspx"> They can only debug processes that they already have <code>PROCESS_ALL_ACCESS</code> to</a>. In other words, non-administrative users can only pwn processes that they already pwn. No protection is being bypassed since you had full access in the first place.
 The SeDebugPrivilege <a href="http://blogs.msdn.com/oldnewthing/archive/2008/03/14/8080140.aspx"> allows you to debug any process, even those to which you do not have full access</a>. This is clearly dangerous, which is why it’s not granted to non-administrative users by default.
 Yuhong Bao also suggests, “How about separating the dangerous activities from the non-dangerous activities, or better, only allowing approved programs to do the dangerous activities?” (Where dangerous activities are defined as things that modify the program behavior.) I’m assuming this is discussing limiting the capabilities of SeDebugPrivilege, since in the absence of SeDebugPrivilege, the scope of your abilities is limited to things you already had the ability to do anyway; debugging didn’t add anything new.
 But even if you limited SeDebugPrivilege to nondestructive actions, you can still lose the farm. This imaginary <i>SeLimitedDebugPrivilege</i> would still let you read a target process’s memory, which means you can do things like steal passwords and snoop on the activities of other users.
 The last suggestion is to “only allow approved programs to do the dangerous activities.” Again, I’m assuming this is discussing limiting the capabilities of SeDebugPrivilege, because without SeDebugPrivilege there is no new danger. But even in that limited context, what is an “approved program”? Approved by whom?
 Must the program be digitally signed by Microsoft? I suspect people who write debuggers which compete with, say, Microsoft Visual Studio, would be upset if they had to submit their debugger to Microsoft for approval. And what are the requirements for receiving this approval? Does the debugger have to pass some battery of tests like WHQL? There are already plenty of readers of this Web site who reject WHQL as useless. Would this “debugger certification” also be useless?
 Or maybe approval consists of merely being digitally signed at all? There are plenty of readers of this Web site who object to the high cost of obtaining a digital certificate (<a href="http://www.verisign.com/code-signing/msft-partner-code-signing/index.html">US$399</a>; I don’t think the <a href="http://www.verisign.com/code-signing/msft-organizational-certificates/index.html"> $99</a> discounted version works for code signing.) And there are also plenty of readers who <a href="http://blogs.msdn.com/oldnewthing/archive/2009/09/24/9898728.aspx#9899019"> consider code signing to be payola</a> and <a href="http://blogs.msdn.com/oldnewthing/archive/2009/09/24/9898728.aspx#9900016"> designed to maximize profit rather than effectiveness</a>.
 Or do you mean that the program needs to be listed in some new registry key called something like <code>Approved Debuggers</code>? Then what’s to stop a rogue program from just auto-approving itself by writing to the Approved Debuggers registry key on its own?</p>
<p> But then again, all this is a pointless discussion once you realize that SeDebugPrivilege is granted by default only to administrators. And since administrators already pwn the machine, there’s no protection that SeDebugPrivilege bypasses: You already bypassed it when you became an administrator. </p>


</body>