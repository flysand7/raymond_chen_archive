<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">When you submit a security vulnerability report, we go the extra mile and try to fix your typos</h1>  <!-- .entry-meta -->

<p>A security vulnerability report arrived that <a href="http://stackoverflow.com/q/40524436/">went like this</a>: </p>
<blockquote class="m">
<ol>
<li>Create the folder <code>C:\Folder</code>     and grant full control to authenticated users.</li>
<li>Create the subfolder <code>C:\Folder\bar</code>.</li>
<li>Create the files <code>C:\Folder\bar\foo</code>     and <code>C:\Folder\foo</code>.</li>
<li>Deny all permissions to everyone      for those two files.</li>
<li>Set the owner of the two files     to a domain administrator or some other user.</li>
</ol>
<p>Even though all access has been revoked to the two files, the following program deletes <code>C:\Folder\foo</code>: </p>
<pre>
#include &lt;windows.h&gt;

int main(int, char**)
{
 DeleteFileW(L"C:\\Folder\\Bar\foo");
 DeleteFileW(L"C:\\Folder\\foo");
 return 0;
}
</pre>
<p>From reading <a href="https://msdn.microsoft.com/library/bb727008.aspx">this page</a>, it seems that file deletion is related to the control on the file itself and not on the parent folder. And anyway, both have the same rights. </p>
</blockquote>
<p>There’s nothing wrong here. Even though all access to the file has been revoked, all authenticated users still have <code>DELETE_CHILD</code> permission on the parent, and <a href="https://blogs.msdn.microsoft.com/oldnewthing/20070726-00/?p=25833">as we noted some time ago</a>, that is sufficient access to delete any file in the directory. This is also noted in <a href="https://msdn.microsoft.com/library/windows/desktop/aa363915(v=vs.85).aspx">the documentation for <code>Delete­File</code></a>: </p>
<blockquote class="q">
<ul>
<li>To delete or rename a file, you must have either     delete permission on the file,     or delete child permission in the parent directory. </li>
</ul>
</blockquote>
<p>The page cited by the finder lists the various permissions available to files and folders. It even says </p>
<blockquote class="q"><p>If a user has full control over a folder, the user can delete files in the folder regardless of the permission on the files. </p></blockquote>
<p>That statement covers the exact scenario described here: The permissions on the parent folder grant full control, which includes <code>DELETE_CHILD</code>. Mind you, that statement could be strengthened by weakening the hypothesis and strengthening the conclusion: </p>
<blockquote class="q"><p>If a user has <u>permission to delete children of a folder</u>, the user can delete files <u>and subfolders</u> in the folder regardless of the permission on the files <u>or subfolders</u>. </p></blockquote>
<p>Table 13-3 reiterates that <i>Full Control</i> on a folder grants permission to delete files and subfolders. </p>
<p>So everything is behaving as normal, and the security team replied, “Upon investigation we have determined that this is not a valid vulnerability as you are an authenticated user, or providing authenticated access to a potential attackers to reproduce this report.” In other words, “You gave authenticated users full control, so it’s not a vulnerability that any authenticated user has full control.” </p>
<p>What made this interesting to me is that the finder posted to Stack Overflow wondering why this wasn’t a bug. And then the finder eventually discovered a typographical error in their sample program: The first <code>Delete­File</code> call passes the string <code>L"C:\\Folder\\Bar\foo"</code> instead of <code>L"C:\\Folder\\Bar\\foo"</code>. “I’m not sure why that was not Microsoft’s answer.” </p>
<p>Okay, let’s look back at the situation. The finder appeared to be concerned about two things but articulated only one of them in the report. </p>
<ol>
<li>The user is able to delete the file     <code>C:\Folder\foo</code>.</li>
<li>The user is not able to delete the file     <code>C:\Folder\bar\foo</code>     even though its permissions are identical to     <code>C:\Folder\foo</code>.</li>
</ol>
<p>The finder raised only the first question, and that’s the question the security team answered. </p>
<p>That said, the security team <a href="https://blogs.msdn.microsoft.com/oldnewthing/20111215-00/?p=8883">tries to be thorough</a> and in this case assumed that the finder created the <code>C:\Folder\bar\foo</code> file for a reason, namely in order to delete it. And if they fix the obvious typo in the program, the file does get deleted. So it seems that the deletion is following the security model in all cases. The finder never said, “But the <code>C:\Folder\bar\foo</code> file is not deleted,” so the security team assumed that the finder was expecting the file to be deleted, and it was. </p>
<p>The security team didn’t mention the typo because they assumed that it was just a transcription error. In general, the security team gives the finder all benefit of the doubt and assume that they are dealing with an experienced programmer who understands the security model. Any misunderstandings are assumed to be due to communication problems or poor explanations. These sorts of things happen a lot with legitimate security issues because it is common to receive vulnerability reports from people for whom English is not their native language. You don’t want to reject an issue just because you can’t understand it. And you definitely don’t want to reject an issue just because there was a typo in the report. </p>
<p>In a sense, the security team failed this particular finder because they assumed <i>too much</i> from the finder.¹ </p>
<p>Sorry. </p>
<p>But you don’t want to take the default position that the finder simply doesn’t understand how the system works, because that biases you toward rejecting issues just because you can’t understand them when they are initially presented to you. </p>
<p>¹ It’s like asking a question at a physics symposium: The speaker is going to assume that you’re a physicist (or at least well-versed enough in physics to understand the proceedings at a physics symposium), and they will fix the obvious errors in your question, assuming that you misspoke or were nervous. But if you’re not a physicist, then those automatic corrections might end up confusing you even more, because they are now answering a question different from the one you asked. </p>


</body>