<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Not actually crossing the airtight hatchway: Applying per-user overrides</h1>  <!-- .entry-meta -->

<p>We receive a number of security vulnerability reports of the form “If I write the following value into the registry at <code>HKEY_</code><code>CURRENT_</code><code>USER\...</code>, then the next time the user does X, I can do bad thing Y.”</p>
<p>The most common version of this is where the registry key is <code>HKEY_</code><code>CURRENT_</code><code>USER\</code><code>Software\</code><code>Classes\</code><code>CLSID\</code><code>...</code>, because that permits you to override a system COM object with a custom COM object.</p>
<p>The fallacy here is hiding behind the change of pronoun in the attack description: If <b style="border: solid 1px black; padding: 0px 2px;">I</b> write the following value into the registry, then the next time <b style="border: solid 1px black; padding: 0px 2px;">the user</b> does X, <b style="border: solid 1px black; padding: 0px 2px;">I</b> can do bad thing Y.</p>
<p>In reality, <b style="border: solid 1px black; padding: 0px 2px;">I</b> and <b style="border: solid 1px black; padding: 0px 2px;">the user</b> are the same person!</p>
<p>In order to write to the user’s registry, you need to be that user or an administrator. Of course, if you are an administrator, then you’re already on the other side of the airtight hatchway, and this entire exercise is pointless.</p>
<p>That leaves the case where the attacker is the user. In other words, the attacker is attacking himself. This is not particularly interesting. It is not a security vulnerability that users can make their own lives miserable. They could start by, say, deleting all their files, then move on to sending profanity-laden email messages to their boss.</p>
<p>As I noted, COM class registrations are a commonly-reported vector for this attack, sometimes even touted as a way to obtain elevation. But that doesn’t work because COM is careful not to use registrations from <code>HKEY_</code><code>CURRENT_</code><code>USER</code> when running elevated. Only <code>HKEY_</code><code>LOCAL_</code><code>MACHINE</code> registrations are consulted when elevated, and attacking those registry key require that you already be elevated, so you haven’t gained anything.</p>
<p>Another place people report this type of false vulnerability is when they see that the <code>HKEY_</code><code>CURRENT_</code><code>USER</code> registry keys are affecting the behavior of <code>svchost.exe</code> processes. But you need to look more closely at <i>which</i> <code>svchost.exe</code> processes are affected. Windows supports services that run under the context of the logged-on user, rather than as a privileged account. These reports breathlessly report that they found a way to inject code into <code>svchost.exe</code> via <code>HKEY_</code><code>CURRENT_</code><code>USER</code> attacks, but they failed to observe that the <code>svchost.exe</code> they attacked is running as the logged-on user. Again, all they did was attack their own process; there is no elevation of privilege.</p>
<p> </p>


</body>