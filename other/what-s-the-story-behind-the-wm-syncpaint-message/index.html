<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">What's the story behind the WM_SYNCPAINT message?</h1>  <!-- .entry-meta -->

<p>Danail wants to know <a href="http://blogs.msdn.com/b/oldnewthing/archive/2010/07/20/10040074.aspx#10040385"> the story behind the <code>WM_SYNC­PAINT</code> message</a>.
 <a href="http://msdn.microsoft.com/en-us/library/dd145221(VS.85).aspx"> The documentation</a> pretty much tells the story. When a window has been hidden, shown, moved or sized, the system may determine that it needs to send a <code>WM_SYNC­PAINT</code> message to the windows of other threads. This message must be passed to <code>Def­Window­Proc</code>, which will send the <code>WM_NCPAINT</code> and <code>WM_ERASE­BKGND</code> messages to the window as necessary.
 When you call the <code>Set­Window­Pos</code> function, the window manager updates the window size, position, whatever, and then it goes around repainting the windows that were affected by the operation. By default, the <code>Set­Window­Pos</code> function does a quick-repaint of the windows before returning. After the function returns, the normal <code>WM_PAINT</code> message does the real work of painting the window. The quick-repaint is done so that there is immediate feedback that the window did change its size, position, whatever.
 This quick-repaint is done by sending a <code>WM_NCPAINT</code> and <code>WM_ERASE­BKGND</code> message to the windows that were affected by the <code>Set­Window­Pos</code> operation. This normally happens without incident, but if one of the windows affected by the <code>Set­Window­Pos</code> operation belongs to another thread, the window manager needs to get into the context of that other thread to finish the job. That’s where <code>WM_SYNC­PAINT</code> comes in. The <code>WM_SYNC­PAINT</code> message means, “Hey, I was going around quick-painting a bunch of windows, but I couldn’t quick-paint you (or any other windows on your thread) because I was on the wrong thread. Could you finish quick-painting yourself (and all the other windows that need quick-painting)? Thanks.”
 Another way of looking at this is that it is a way for the window manager to teleport itself into another thread so it can finish its work. “Lah di dah, quick-painting all the windows, oh crap, I can’t quick-paint that window because it’s on the wrong thread. Let me inject myself into that other process [trivial, since <i>I’m the window manager</i>, <a href="http://dashes.com/anil/2007/04/cats-can-has-gr.html"> I’M IN YR PROCESS REEDING YR MSGS</a>], and now I can send a message to myself [<code>WM_SYNCPAINT</code>], and when that other copy of me receives it, he’ll finish where I left off.”
 If you don’t like any of this teleportation or multiple-copies-of-yourself imagery, you can say that the <code>WM_SYNC­PAINT</code> message means, “Quick-paint this window as part of a quick-paint operation begun on another thread.”</p>
<p> If you don’t want this quick-paint to take place, you can follow the instructions in the documentation and <a href="http://msdn.microsoft.com/en-us/library/ms633545(VS.85).aspx"> pass the <code>SWP_DEFER­ERASE</code> flag to suppress the <code>WM_SYNC­PAINT</code> message</a>. </p>


</body>