<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Dubious security vulnerability: Luring somebody into your lair</h1>  <!-- .entry-meta -->

<p>A security report was received that went something like this: </p>
<blockquote class="q"><p>The XYZ application does not load its DLLs securely. Create a directory, say, <code>C:\Vulnerable</code>, and copy <code>XYZ.EXE</code> and a rogue copy of <code>ABC.DLL</code> in that directory. When <code>C:\Vulnerable\XYZ.EXE</code> is run, the XYZ program will load the rogue DLL instead of the official copy in the System32 directory. This is a security flaw in the XYZ program. </p></blockquote>
<p>Recall that <a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/06/20/10176772.aspx">the directory is the application bundle</a>, The fact that the <code>XYZ.EXE</code> program loads ABC.DLL from the application directory rather than the System32 directory is not surprising because the ABC.DLL has been placed inside the <code>XYZ.EXE</code> program’s trusted circle. </p>
<p>But what is the security flaw, exactly? </p>
<p>Let’s identify the attacker, the victim, and the attack scenario. </p>
<p>The attacker is the person who created the directory with the copy of <code>XYZ.EXE</code> and the rogue <code>ABC.DLL</code>. </p>
<p>The victim is whatever poor sap runs the <code>XYZ.EXE</code> program from the custom directory instead of from its normal location. </p>
<p>The attack scenario is </p>
<ul>
<li>Attacker creates a directory, say, <code>C:\Vulnerable</code>. 
<li><code>copy C:\Windows\System32\XYZ.EXE C:\Vulnerable\XYZ.EXE</code>
<li><code>copy rogue.dll C:\Vulnerable\ABC.DLL</code>
<li>Convince a victim to run <code>C:\Vulnerable\XYZ.EXE</code>. </li></li></li></li></ul>
<p>When the victim runs <code>C:\Vulnerable\XYZ.EXE</code>, the rogue DLL gets loaded, and the victim is pwned. </p>
<p>But the victim was already pwned even before getting to that point! Because the victim ran <code>C:\Vulnerable\XYZ.EXE</code>. </p>
<p>A much simpler attack is to do this: </p>
<ul>
<li>Attacker creates a directory, say, <code>C:\Vulnerable</code>. 
<li><code>copy pwned.exe C:\Vulnerable\XYZ.EXE</code>
<li>Convince a victim to run <code>C:\Vulnerable\XYZ.EXE</code>. </li></li></li></ul>
<p>The rogue <code>ABC.DLL</code> is immaterial. All it does is <a href="http://blogs.msdn.com/b/oldnewthing/archive/2009/04/09/9539191.aspx">crank up the degree of difficulty</a> without changing the fundamental issue: If you can trick a user into running a program you control, then the user is pwned. </p>
<p> This is another case of <a href="http://blogs.msdn.com/b/oldnewthing/archive/2007/08/07/4268706.aspx">if I can run an arbitrary program, then I can do arbitrary things</a>, also known as <a href="http://blogs.msdn.com/b/oldnewthing/archive/2007/08/07/4268706.aspx#4282521">MS07-052: Code execution results in code execution</a>. </p>
<p>Note that the real copy of <code>XYZ.EXE</code> in the System32 directory is unaffected. The attack doesn’t affect users which run the real copy. And since <code>C:\Vulnerable</code> isn’t on the default <code>PATH</code>, the only way to get somebody to run the rogue copy is to trick them into running the wrong copy. </p>
<p>It’s like saying that there’s a security flaw in Anna Kournikova because people can create things that look like Anna Kournikova and trick victims into running it. </p>


</body>