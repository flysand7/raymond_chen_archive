<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">The story of MUI, as told by others (with some commentary)</h1>  <!-- .entry-meta -->

<p>First, the story as told by others:</p>
<ul>
<li> <a href="http://blogs.msdn.com/astebner/archive/2007/01/13/information-about-windows-vista-multilingual-user-interface-mui.aspx">     Information about Windows Vista Multilingual User Interface (MUI)</a> </li>
<li> <a href="http://blogs.msdn.com/michkap/archive/2007/01/18/1487464.aspx">     What the %$#&amp; is up with localized paths in Vista?</a> </li>
<li> <a href="http://blogs.msdn.com/michkap/archive/2007/02/21/1736611.aspx">     Here is what’s up with localized paths in Vista (and in Windows!)</a> </li>
<li> <a href="http://blogs.msdn.com/michkap/archive/2007/09/21/5025885.aspx">     If you had gotten there first, you might have staked your claim too!</a> </li>
<li> <a href="http://blogs.msdn.com/michkap/archive/2007/10/31/5790802.aspx">     Making things better out from under people: the story of MUI</a> </li>
<li> <a href="http://blogs.msdn.com/cjacks/archive/2008/01/07/why-can-t-i-rename-a-copy-of-my-documents-folder-on-windows-vista.aspx">     Why Can’t I Rename a Copy of My “Documents” Folder on Windows Vista?</a> </li>
</ul>
<p> Now the question you’re all going to ask so I may as well answer it: Why is this information kept in a <code>desktop.ini</code> file instead of being attached to the file itself (say, in an alternate stream)? If it were in an alternate stream, then it would track the file when it was moved or copied.
 First answer: Because alternate streams require NTFS. Localized names were introduced in Windows 2000, and Windows 2000 gave you the option of formatting your drive as FAT or NTFS. (It wasn’t until Windows Vista that NTFS became mandatory.) Therefore the mechanism for localized names needed to work when your drive was formatted as FAT.
 Okay, fine, maybe you tell people, “Sorry, this feature requires NTFS.” All those multinational corporations who use FAT-formatted drives in the year 2000 are screwed.
 Well, placing the information in an alternate data stream means that each file would have to be accessed <i>just to get its name</i>. Remember, <a href="http://blogs.msdn.com/oldnewthing/archive/2006/04/06/569873.aspx"> it’s more efficient when you buy in bulk</a>. Consider a directory with 500 files. A simple directory listing like one provided by <code>cmd.exe</code> takes, say, seven I/O requests (open directory, five “give me the next 100 files”, close directory). If each file had to be opened in order to probe for an alternate stream, you now have 507 I/O requests: open directory, five “give me the next 100 files”, close directory; and then 500 “open alternate stream on this file” calls that fail. And that was the optimistic case where the localized name doesn’t exist. For the pessimistic case where every file has a localized name, the I/O count balloons to 1507: open directory, five “give me the next 100 files”, close directory; and then 500 × (open alternate stream, read localized name, close alternate stream).
 You increased the number of I/O requests by a factor of over 200. And when you are looking at files on a slow network (hello, multinational company with servers all over the world), that factor can be deadly. Suppose the ping time to the server is 500ms. The <code>cmd.exe</code> program gets you the directory listing in three and a half seconds. The alternate data stream localized name version takes <i>twelve minutes</i>.
 On the other hand, if all the localized names are placed in a single file, then the I/O count is only 10: open directory, five “give me the next 100 files”, close directory; open <code>desktop.ini</code>, read contents, close <code>desktop.ini</code>. We’re down to five seconds. Not as good as three and a half seconds, but way better than twelve minutes. And if, in the common case, the directory contains no localized names, the  <i>open <code>desktop.ini</code></i> step fails, and we save two I/O’s, bringing our time down to four seconds. And then you can be clever and say, “Wait a second, I already have the directory listing; I can just look at the results to see if <code>desktop.ini</code> is on the list. If not, then I don’t even have to bother trying to open it!” Now you are back to three and a half seconds.
 Okay, maybe you tell people, “Sorry, this feature requires a high-speed network.” All those multinational corporations with servers around the world are screwed. The theoretically highest-speed network connection between New York and Tokyo has a 72ms ping time because that’s how fast it takes light itself to travel that distance and back. Your 500-file directory takes nearly two minutes to display.
 Seeing as multinational corporations were the initial target audience for the MUI feature (since they’re the ones who are most likely to have users with different language preferences), designing your feature so that your target audience can’t use it seems like a pretty bad execution plan.
 A file’s name is traditionally considered metadata, and traditionally, metadata is visible without requiring access to the file. A file can show up in a directory listing even though you don’t have access to it. But if the file’s localized name is stored in the file itself, you now have the situation where you don’t even know the name of the file because you can’t access it. This is even worse than <a href="http://blogs.msdn.com/oldnewthing/archive/2009/05/28/9645162.aspx"> <i>I’m sorry, you don’t have permission to know where this shortcut file should show up in the Explorer window</i></a>. This would be <i>I’m sorry, you don’t have permission to know the name of the file in this directory listing</i>.
 Remember that reading from an alternate data stream <a href="http://blogs.msdn.com/oldnewthing/archive/2007/01/09/1436685.aspx"> triggers a recall</a> if the file had been archived to tape. You don’t want to have to restore an entire directory from tape just because somebody opened the folder in Explorer.</p>
<p> And finally, alternate data streams are very fragile. Any tool that processes a file has a decent chance of inadvertently destroying the alternate data streams. (And good luck if your backup program doesn’t preserve the alternate data streams.) </p>


</body>