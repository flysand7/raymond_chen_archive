<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why does Explorer generate a page fault every two seconds?</h1>  <!-- .entry-meta -->

<p>If you fire up Task Manager and look at the page fault count, you’ll see that even when nothing is going on, Explorer takes a page fault every two seconds. Isn’t this bad? I though you weren’t supposed to poll.</p>
<p> Here’s an interesting experiment: Change your update speed to High. Wow, the page fault rate quadruples to a page fault every half second. At this point, you should start suspecting some sort of Heisenbehavior, that is, that the behavior of the system is changing due to your act of observing it. </p>
<p> The page faults are <a href="http://blogs.msdn.com/oldnewthing/archive/2005/10/07/478215.aspx"> coming from the CPU meter in the notification area</a>. At each update, Task Manager sets a new icon into the notification area, and Explorer resizes it from the default icon size (which is the size of the icon that Task Manager hands it) to the notification icon size. To obtain the best quality image, the taskbar uses the <code>LR_COPYFROMRESOURCE</code> flag. This means that the window manager goes back to <code>taskmgr.exe</code> to locate the best match, which in turn triggers a soft page fault. It’s a soft page fault since the information is already in the cache (after all, we access it every two seconds!), so no actual disk access occurs. But it still shows up as a page fault, and that makes some people nervous. </p>
<p> What could Task Manager do to avoid triggering this false alarm and freaking people out? Well, when it calls <code>Shell_NotifyIcon</code>, it could pass icons that were loaded at the size <code>GetSystemMetrics(SM_CXSMICON)</code> by <code>GetSystemMetrics(SM_CYSMICON)</code>. That way, when the notification area makes a copy of the icon, it won’t need to be resized since it’s already at the correct size. </p>
<p> Now, there’s really nothing wrong with the soft page faults aside from all the time the shell team has to spend explaining to people that nothing is actually wrong. Next time, we’ll look at the wrong way of avoiding the soft page faults. Even though it’s the wrong way, the exercise is still instructive. </p>
<p> [Raymond is currently away; this message was pre-recorded.] </p>


</body>