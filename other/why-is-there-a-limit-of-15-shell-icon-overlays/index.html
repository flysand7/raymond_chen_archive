<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why is there a limit of 15 shell icon overlays?</h1>  <!-- .entry-meta -->

<p>There is a limit of fifteen shell icon overlays. Why fifteen? </p>
<p>The value 15 came from the corresponding limit for image lists. The <a href="http://msdn.microsoft.com/library/bb775227"><code>Image­List_Set­Overlay­Image</code></a> function supports up to 15 image list overlays per image list. (Hey, it used to be worse. The limit used to be only 3!) </p>
<p>Okay, but why only 15? Why not more? </p>
<p>The overlay image is one of the pieces of information used when drawing an image from an image list. The options are encoded in the <code>fStyle</code> parameter, and when the bits were divided up for various purposes, four bits were available to be used to specify the overlay image. (You get 15 overlay images instead of 16 because you lose one of the values in order to specify “no overlay.”) </p>
<p>Okay, but the values in the <code>fStyle</code> parameter use only the bottom 16 bits. What about the upper 16 bits? There’s plenty of room there. </p>
<p>The 16-bit limit was carried over from the 16-bit version of the common controls (which still needed to be supported in Windows 95). Of course, nowadays, nobody cares about the 16-bit version of the common controls, so why not start using the upper bits? </p>
<p>There’s an unsatisfying explanation: The code internally that manages the <code>fStyle</code> still uses a <code>WORD</code> in some places, so all the code that manages the <code>fStyle</code> would have to be revised. This occurs in multiple modules across Windows, so a synchronized change would have to be made across multiple components. This is a breaking change at the binary level because the interfaces are no longer compatible. Breaking changes are procedurally difficult to coordinate: The affected code may not be visible to the shell team because they are <a href="http://blogs.msdn.com/b/oldnewthing/archive/2013/08/20/10442834.aspx">sitting in a far-away leaf branch</a> that has not yet RI’d to the trunk. It might be that expanding <code>fStyle</code> from a <code>WORD</code> to a <code>DWORD</code> has far-reaching consequences for some component. </p>
<p>Like I said, this is unsatisfying. Basically it boils down to “It would be a lot of work and we are lazy.” </p>
<p>Another unsatisfying explanation is that the image list serialization format would be affected. This is one of the far-reaching consequences I hinted at: Changing a file format means that you also need to come up with a compatibility story. What happens if an old program encounters a file in the new format? </p>
<p>Okay, so maybe we leave image lists the way they are, but change Explorer so that it internally allows more than 15 overlays by, say, “paging” overlays in and out of the system image list. But this would require taking a lock during image list drawing operations, which currently can be performed concurrently. But the system image list is exposed to applications so that they can draw out of them directly, and applications won’t know about the extra serialization that applies only to the system image list. So that’s a non-starter, too. </p>
<p>A bigger problem is that the overlay indices are exposed to applications via the <code>SHGet­File­Info</code> function. If you ask for <code>SHGFI_OVERLAY­INDEX</code>, then the function returns the overlay index to the application, and if the overlay index is greater than 15, older applications won’t know how to draw with it. </p>
<p>Now, these problems aren’t completely insurmountable. For example, we could invent a new flag to <code>SH­Get­File­Info</code> that says, “I understand overlays greater than 15,” and if the caller doesn’t set the flag, then the function just pretends that those overlays don’t exist. The calling application doesn’t draw the icon correctly (it’s missing the overlay), but at least it doesn’t crash. </p>
<p>But the main reason this doesn’t get done is simply that overlays are <a href="https://blogs.msdn.microsoft.com/oldnewthing/20091209-00/?p=15723">not recommended as the way to convey metadata about a file to the user</a>. An icon can have only one overlay, which means that if multiple overlays apply, then the system will arbitrarily choose one to show, and the others will lose. </p>
<p>Windows 10 takes a step away from icon overlays by moving the OneDrive file synchronization status indicator from an icon overlay to a separate <i>Status</i> column. </p>
<p><img height="662" src="https://gxcuf89792.i.lithium.com/t5/image/serverpage/image-id/15087i66C1AE682A061487" title="Status column highlighted" width="942"/> </p>
<p>Since it’s a separate column, there’s room to put more than one status icon there. </p>


</body>