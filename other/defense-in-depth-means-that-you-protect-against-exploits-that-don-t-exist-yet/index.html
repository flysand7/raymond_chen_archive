<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Defense in depth means that you protect against exploits that don’t exist yet</h1>  <!-- .entry-meta -->

<p>Defense in depth is about protecting against threats that are already being protected against, just in case the existing protection fails. This is why there is not merely a lock on your safety deposit box, but also a lock on the door to the safety deposit box room, and then a lock on the doors of the bank itself. This is why you wear your seat belt even though the car is equipped with air bags. This is why <a href="http://blogs.msdn.com/oldnewthing/archive/2008/04/16/8398400.aspx"> factories have multiple safety systems</a>. It’s why, when you put away a gun, you set the safety <i>and</i> remove the ammunition <i>and</i> lock the gun case.</p>
<p> An insistent anonymous commenter <a href="http://blogs.msdn.com/oldnewthing/archive/2007/12/31/6909007.aspx#6970295"> refused to believe in this principle</a> and couldn’t distinguish between <a href="http://blogs.msdn.com/oldnewthing/archive/2007/12/31/6909007.aspx#6980588"> the absence of a known security vulnerability and the potential for one</a>, believing that security is a boolean value, that you’re either secure or you’re insecure, and that if two systems are identical except that the second system has an additional safety check, this is proof that the first system must have been insecure. </p>
<p> As I described in the comments to the article, there is the potential for bad things to happen if a COM data object is allowed into the process. Even though the CSRSS process never calls any of the potentially dangerous functions in a dangerous way, the potential for some other flaw to result in dangerous behavior creates enough risk that the trade-off tipped toward removing the <i>potential</i> for problems, even though the potential is currently (and hopefully will always remain) unrealized. </p>
<p> Remember that one of the guidelines of security is that the more valuable the target, the more effort you put into securing it. In this case, CSRSS runs with System security privileges, which is even higher than Administrator. You want to erect a lot of barriers for this puppy. </p>
<p> It’s like a hospital that has the rule “No cell phones allowed in hospital rooms because they may interfere with the equipment.” The staff instruct you to leave your phone outside, but you insist that your phone does not pose a problem because it’s turned off, and besides, it doesn’t use the same radio frequency as the monitoring equipment. Tough. Defense in depth. Even if it’s turned off, even if uses a different radio frequency, they won’t let it into the room. </p>
<p> The same thing is true with data objects. CSRSS is careful to extract only the information it needs, but that’s like walking into a hospital room with a cell phone whose antenna has been switched off. Sure, the antenna is off, but somebody might bump into you and accidentally turn it on, or there may be some software flaw in the phone that causes it to turn on spontaneously. Sure, you might argue that those failures aren’t your fault, so you shouldn’t be blamed for them, but try telling that to the person whose monitoring equipment failed to notify the hospital staff of an irregular heartbeat. </p>
<p> People who study security vulnerabilities have quite a <a href="http://msdn.microsoft.com/msdnmag/issues/07/11/ExploitingCrashes/"> wide array of tricks available to them once they find even the tiniest crack</a>. Even something as simple as a null pointer fault (in itself just a denial of service and not a source of pwnage) can be combined with other techniques and become <a href="http://www.uninformed.org/?v=4&amp;a=5&amp;t=txt"> a full-fledged exploit</a>. </p>
<p> For example, even though your cell phone antenna is off, its Bluetooth transceiver may still be on, and somebody might be able to hack into your Bluetooth headset and convince it to tell the cell phone, “Hey, I’d like to make a call. Please turn on your antenna.” Even though this is a security flaw in the Bluetooth headset, it was used as a stepping stone into hacking your cell phone. </p>
<p> There’s also the possibility that you simply forgot that you had set a text message for delayed delivery, causing the phone to turn on its antenna when the delivery time is reached. Oops. You messed up, and now somebody is intensive care. </p>
<p> As of this writing, there is no known exploit for drag and drop into console windows, but since drag and drop uses highly extensible technology (namely COM and data objects), the possibility that one of those extension points may be used as an attack vector was deemed too great a risk compared to the benefit of the feature. The anonymous commenter concludes, </p>
<blockquote class="q"><p> Now if this is not a security hole, then either Csrss doesn’t execute code in OLE objects it receives, or it doesn’t accept any OLE objects received, or isn’t able to receive OLE objects at all. Which one is it? </p></blockquote>
<p> CSRSS does not execute untrusted code in OLE objects it receives, but the fact that OLE objects are in the CSRSS process at all give the security folks the heebie-jeebies. Although there is no known security hole, there is great <i>potential</i> for a security hole, and that’s the reason for removing the potentially dangerous code from CSRSS even though it is (in theory) never executed. </p>
<p> I bet you’d be nervous if somebody pointed a loaded gun at you even though the safety is engaged. </p>
<p> Other discussion of defense in depth, including more examples: </p>
<ul>
<li> <a href="http://blogs.msdn.com/larryosterman/">     Larry Osterman</a>     explains     <a href="http://blogs.msdn.com/larryosterman/archive/2005/06/23/431918.aspx">     why defense in depth is so important</a>     and     <a href="http://blogs.msdn.com/larryosterman/archive/2006/10/04/Sometimes-people-don_2700_t-really-get-the-point-of-defensive-programming-for-security_2E002E002E00_.aspx">     responds to an article that rejects the notion</a>. </li>
<li> <a href="http://blogs.msdn.com/michael_howard/">     Michael Howard</a>     gives an example of     how a defense in depth precaution     <a href="http://blogs.msdn.com/michael_howard/archive/2007/01/10/why-windows-vista-is-unaffected-by-the-vml-bug.aspx">     protected against a security vulnerability that     was not yet known to exist</a>. </li>
<li> <a href="http://blogs.msdn.com/ericlippert/">     Eric Lippert</a>     describes     <a href="http://blogs.msdn.com/ericlippert/archive/2005/02/03/you-want-salt-with-that-part-three-salt-the-hash.aspx">     the use of salt as a defense in depth     against password theft</a>. </li>
<li> <a href="http://blogs.msdn.com/rssteam/">     The RSS Technologies Team</a>     describes how     Internet Explorer removes all script from feeds before displaying them,     and then, as a defense in depth precaution,     <a href="http://blogs.msdn.com/rssteam/archive/2006/09/09/More-on-Feed-Security.aspx">     displays the feed in a zone that forbids scripting</a>     just in case there happens to be a bug in the script removal code. </li>
</ul>


</body>