<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Pulling sleight of hand tricks in a security vulnerability report, or maybe it was a prank</h1>  <!-- .entry-meta -->

<p>It can sometimes be hard to tell the difference between somebody who is playing an elaborate prank and somebody who has no idea what they’re doing. (Just like how it can sometimes be hard to <a href="/code/a-question-about-avoiding-page-faults-the-first-time-newly-allocated-memory-is-accessed"> tell the difference between a very advanced question and a very naïve one</a>.)</p>
<p>A security vulnerability report came in that claimed that an unprivileged user could extract certain types of information from an object despite not having access to it. The evidence for this alleged vulnerability did not take the form of a document that explained the nature of the problem, however. It came in the form of a video, a silent screen recording that purported to demonstrate the vulnerability.</p>
<p>The video contained no narration. You just had to sit there and watch a twelve-minute silent movie. There was no accompanying description, so it was like watching a magic trick performed by a silent magician, where you see the story unfold before your eyes without knowing where it’s going to go next. You just have to sit back and wait for the surprise ending. For a magic trick, the suspense is part of the enjoyment. Not so much for a security investigation.</p>
<p>The video did seem to demonstrate that a user was indeed extracting information from the resource. But at the eight-minute mark, the video shows the user being added to the Administrators group. The user then signs on, opens an elevated command prompt, and runs the alleged exploit. The finder claimed that an unprivileged user could extract the information, but that’s not what their demonstration video showed. We asked for clarification.</p>
<p>The finder came back with another video, this one even longer than the previous one. (At least they didn’t reply with just a meme GIF.) The second video was still unnarrated, but at least it provided more details, showing each step in painstaking detail. Opening the security dialog to show the permissions on the resource and confirming that the user did not have access. Opening the source code in Notepad and scrolling through it.</p>

<p>And then it ran the proof of concept.</p>

<p>And then in another window, they made changes to the object, and the exploit was able to detect it:</p>

<p>I tried playing along at home, but could not get the reported results.</p>
<p>So I studied the video more closely, and I observed a sleight-of-hand trick. Maybe you noticed it, too.</p>
<p>Look closely at the contents of the console.</p>
<p>Observe that the command line <tt>exploit.exe</tt> is not present any more.</p>
<p>In the video, the finder types <tt>exploit.exe</tt> into the command line, but instead of hitting <kbd>Enter</kbd>, they appear to hit <kbd>ESC</kbd> and erase the line. Despite the fact that <tt>exploit.exe</tt> was not run from the command line, it was nevertheless generating output.</p>
<p>What I suspect happened is that the finder had a copy of <tt>exploit.exe</tt> running <i>already</i>. That copy of <tt>exploit.exe</tt> was started while the standard user still had access to the resource. <a href="https://devblogs.microsoft.com/oldnewthing/20200320-00/?p=103579"> The security check happens at the acquisition of the handle</a>, and once you have a handle, it’s yours to keep. So the already-running copy of <tt>exploit.exe</tt> was able to gain access to the resource, and it was able to retain that access even after the ACLs on the resource were changed so that the standard user no longer has access.</p>
<p>It is that already-running copy of <tt>exploit.exe</tt> that was monitoring the resource. Just like how the magician has an identical red ball already hiding under the cup, but fools you into thinking it’s the same red ball that vanished just moments ago.</p>
<p>So you tell me: Was this somebody carrying out an elaborate prank or somebody who simply didn’t understand what they were doing?</p>
<p>Whether it was intended as such or not, this ended up being an effective denial-of-service attack against me personally, since I ended up spending quite a bit of time watching the videos closely, then reverse-engineering what the finder <i>believed</i> the vulnerability to be, and then studying the videos again to find out where they went wrong.</p>
<p> </p>


</body>