<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">When people ask for security holes as features: Non-administrators reading other users' stuff</h1>  <!-- .entry-meta -->

<p>Via the suggestion box, <a href="http://www.aaronlerch.com/"> Aaron Lerch</a> asks whether <a href="http://blogs.msdn.com/oldnewthing/pages/407234.aspx#1214619"> a non-administrator can retrieve/evaluate environment variables as they would appear for another user</a>.
 This falls into the category of asking for a security hole as a feature, specifically an <i>information disclosure</i> security hole, because you are extracting information from a user’s private data which has security access controls that do not grant everybody access. Generally speaking, <a href="http://blogs.msdn.com/oldnewthing/archive/2004/03/12/88572.aspx"> users have full access to their data, as does the operating system itself, but nobody else</a>. Administrators can get access to the data by <a href="http://blogs.msdn.com/oldnewthing/archive/2008/02/27/7912126.aspx"> taking ownership and modifying the ACL</a> or using security overrides like <a href="http://blogs.msdn.com/oldnewthing/archive/2008/03/14/8080140.aspx"> <code>Se­Debug­Privilege</code></a>, but that’s the general idea. And certainly, unprivileged users don’t have access to the data from other unprivileged users.</p>
<p> The way to get a user’s initial environment variables is to call the <a href="http://msdn.microsoft.com/en-us/library/bb762270.aspx"> <code>Create­Environment­Block</code></a> function, passing the token of the user you are interested in. Note that it’s more than just scraping the registry, because you also have to take into account group policy objects and the possibility that the information in the registry is incorrect because it is a stale <a href="http://blogs.msdn.com/oldnewthing/archive/2005/06/30/434209.aspx"> cached roaming profile</a>. </p>


</body>