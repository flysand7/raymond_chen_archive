<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why doesn’t my keyboard hook get called for keyboard messages I manually posted?</h1>  <!-- .entry-meta -->

<p>A customer was generating synthesized keyboard input by posting <code>WM_KEY­DOWN</code> and related messages to a window. They found that a <code>WH_KEYBOARD</code> keyboard hook was not triggering for these keyboard messages and they wanted to know why. </p>
<p>You already know enough to answer this question, though the pieces are scattered about over several years for you to put together. </p>
<p>First of all, <a href="http://blogs.msdn.com/b/oldnewthing/archive/2005/05/30/423202.aspx">you can’t simulate keyboard input with <code>Post­Message</code></a> because you are going straight to the end product <a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/07/28/10190521.aspx">without going through the other paperwork that leads to that end product</a>. </p>
<p>It’s like sending a letter to a friend by putting it directly in his mailbox, and then saying, “My friend filed a change of address with the postal service, and anything sent to his address is supposed to be redirected to his new address, but my letter is still sitting in his mailbox at his old address.” Well, yeah, because you didn’t actually <i>mail</i> the letter. You bypassed the mail system and merely replicated the end product (a letter in the mailbox). You will also find that if you go to the postal service’s Web site and ask for a delivery confirmation of the letter, the Web site is going to say, “Sorry, we have no record of having delivered that letter to that mailbox.” </p>
<p>The window manager <a href="http://blogs.msdn.com/b/oldnewthing/archive/2013/05/24/10421022.aspx">does not have a fake message detector</a> that looks to see if you posted a fake input message, and if so, reverse-engineers the logic that led to that fake input message and internally simulates the actions of that reverse-engineered logic. If you post a <code>WM_CHAR</code> message, it’s not going to say, “Well, let me see, to get to that message, the user needed to have pressed the <kbd>Shift</kbd> key, then pressed the <kbd>A</kbd> key, then released the <kbd>A</kbd> key, then released the <kbd>Shift</kbd> key, so I’ll retroactively send out <code>WH_KEYBOARD</code> hook notifications for those events, and if any of the hooks blocks the event, then I created a time paradox, and I have to go back in time and kill the program that posted the <code>WM_CHAR</code> message.” (It’s also not going to <a href="http://blogs.msdn.com/b/oldnewthing/archive/2013/05/31/10422524.aspx">insert the posted message in the processing queue in the correct order relative to true input messages</a>.) </p>
<p>If you want to simulate input, you need to send it through the input system with functions like <code>Send­Input</code>. </p>


</body>