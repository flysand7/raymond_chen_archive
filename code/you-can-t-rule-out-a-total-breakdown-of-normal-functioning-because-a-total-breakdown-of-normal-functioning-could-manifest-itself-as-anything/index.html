<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">You can't rule out a total breakdown of normal functioning, because a total breakdown of normal functioning could manifest itself as anything</h1>  <!-- .entry-meta -->

<p>A customer was attempting to study a problem that their analysis traced back to the <code>malloc</code> function returning <code>NULL</code>.</p>
<blockquote class="q"><p> Is it a valid conclusion that there is no heap corruption? </p></blockquote>
<p> While heap corruption may not be the avenue of investigation you’d first pursue, you can’t rule it out. <a href="http://blogs.msdn.com/b/oldnewthing/archive/2009/11/13/9921676.aspx"> In the presence of a total breakdown of normal functioning</a>, anything can happen, including appearing to be some other type of failure entirely.
 For example, the heap corruption might have corrupted the bookkeeping data in such a way as to make the heap behave as if it were a fixed-sized heap, say by corrupting the location where the heap manager remembered the <code>dwMaximumSize</code> parameter and changing it from zero to nonzero. Now, the next time the heap manager wants to expand the heap, it sees that the heap is no longer expandable and returns <code>NULL</code>.
 Or maybe the heap corruption tricked the heap manager into thinking that it was operating under <a href="http://technet.microsoft.com/en-us/library/bb457063.aspx"> low resource simulation</a>, so it returned <code>NULL</code> even though there was plenty of memory available.
 Remember, once you’ve entered the realm of undefined behavior, <i>anything</i> is possible. Heck, one possible response to heap corruption is the installation of a rootkit.
 After all, that’s how more advanced classes of malware work. They exploit a vulnerability to nudge a process into a subtle failure mode, and then push the failure mode over the edge into a breakdown, and then exploit the breakdown to get themselves installed onto your system, and then cover their tracks so you don’t realize you’ve been pwned.
 Maybe the heap was corrupted in a way that cause a rootkit to become installed, and the rootkit patched the <code>malloc</code> function so it returned <code>NULL</code>.
 Like I said earlier, the possibility of heap corruption is probably not the avenue I would investigate first. But you can’t rule it out either.</p>
<p> <b>Bonus chatter</b>: Since heap corruption can in principle lead to <i>anything</i>, any bug that results in heap corruption automatically gets a default classification of <i>Arbitrary Code Execution</i>, and if the heap corruption can be triggered via the network, it gets an automatic default classification of <i>Remote Code Execution</i> (RCE). Even if the likelihood of transforming the heap corruption into remote code execution is exceedingly low, you still have to classify it as RCE until you can rule out all possibility of code execution. (And it is extremely rare that one can successfully prove that a heap overflow is not exploitable under any possible conditions.) </p>


</body>