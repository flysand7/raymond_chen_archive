<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How to create a file mapping that allows others to open the file in exclusive mode?</h1>  <!-- .entry-meta -->

<p>A customer had a tool that opens files like DLLs and TLBs in order to extract information from them. </p>
<blockquote class="q">
<p>We currently use <code>Create­File</code>, <code>Create­File­Mapping</code>, and <code>Map­View­Of­File</code> to access the file. The problem is that the <code>Create­File­Mapping</code> prevents the file from being renamed or deleted, even if the <code>Create­File</code> opened the file with a sharing mode that permits those operations. It is our understanding that this is expected behavior. </p>
<p>Since DLLs and TLBs under active development are frequently deleted or overwritten, our use of <code>Create­File­Mapping</code> interferes with developer workflow because the user’s build will fail with a sharing violation. We were wondering if there is an alternative to <code>Create­File­Mapping</code> that would allow the file to be renamed, deleted, or written to. We know that we could slurp the entire file into memory and operate on the in-memory copy, but we were hoping for something less drastic. </p>
</blockquote>
<p>Yes, there is something less drastic. In fact, this is the type of scenarios for which opportunistic locks were created: You want to access a file, but you don’t want your access to interfere with anybody else who wants to access the file after you get access. </p>
<p>For a code sample, I defer to <a href="https://blogs.msdn.microsoft.com/oldnewthing/20130415-00/?p=4663">my earlier discussion of opportunistic locks</a>. </p>


</body>