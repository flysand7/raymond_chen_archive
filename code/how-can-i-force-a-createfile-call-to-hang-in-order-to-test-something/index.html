<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How can I force a CreateFile call to hang, in order to test something?</h1>  <!-- .entry-meta -->

<p>A customer was doing some testing and wanted to know if there was a way to force a call to <code>Create­File</code> to hang, so that they can test their program’s hang detection and recovery code. </p>
<p>You can ceate these scenarios with careful use of opportunistic locks (also known as oplocks). <a href="http://blogs.msdn.com/b/oldnewthing/archive/2013/04/15/10410965.aspx">The sample program I wrote some time ago</a> can be used, for example, to cause a <code>Create­File</code> call requesting write access to hang until the oplock is released. </p>
<p>To cause a <code>Create­File</code> call requesting read access to hang until the oplock is released, use <code>OPLOCK_LEVEL_CACHE_WRITE</code>; this means that the oplock owner is caching writes, so nobody can read from the file until the cached writes are flushed out. </p>


</body>