<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">If I call GetExitCodeThread for a thread that I know for sure has exited, why does it still say STILL_ACTIVE?</h1>  <!-- .entry-meta -->

<p>A customer reported that when they took the thread handle returned by the <code>_beginthread</code> function and passed it to <code>Get­Exit­Code­Thread</code>, the function reported that the thread was <code>STILL_</code><code>ACTIVE</code>, even though the thread is known to have already exited. </p>
<p>The customer found this text in <a href="http://msdn.microsoft.com/en-us/library/kdzttdcb.aspx">the documentation for <code>_beginthread</code></a> and wants more information about the case where the function can return an invalid handle if the thread exits quickly. </p>
<blockquote class="q"><p> If the thread that’s generated by <b>_beginthread</b> exits quickly, the handle that’s returned to the caller of <b>_beginthread</b> might be invalid or point to another thread. </p></blockquote>
<p>The point is that the <code>_begin­thread</code> function returns a handle to a thread, but that handle is valid only as long as the thread is running. <a href="https://blogs.msdn.microsoft.com/oldnewthing/20170929-00/?p=97115">Once the thread exits, the handle spontaneously becomes invalid</a>, at which point it becomes eligible for recycling. </p>
<p>The upshot of this is that the handle returned by <code>_begin­thread</code> is useless, because it can go invalid for reasons outside your control. </p>
<p>The source code for the C runtime library is included with Visual Studio. You can read the source code for the <code>_begin­thread</code> function if you want to understand what’s going on. </p>
<p>The customer asked whether this behavior of <code>_begin­thread</code> would explain the problem they are seeing. </p>
<p>Yes, it is exactly the problem you are seeing. Calling <code>Get­Exit­Code­Thread</code> with the handle returned by <code>_begin­thread</code> is useless. </p>
<ul>
<li>If the thread is running, then you will get     <code>STILL_</code><code>ACTIVE</code>.</li>
<li>If the thread is not running, then you are using an invalid     parameter and you will get garbage.     The value <code>STILL_</code><code>ACTIVE</code> is one possible     manifestation of garbage.</li>
</ul>
<p>In general, the return value from <code>_begin­thread</code> is not useful and should not be used for anything other than determining whether the thread was started successfully. </p>
<p>We recommend that if the customer wants to use the thread handle, they should switch to <code>_begin­thread­ex</code> and remember to close the handle when they are done. </p>
<p>The customer explained that their application was originally developed by another company. They had considered switching from <code>_begin­thread</code> to <code>_begin­thread­ex</code>, but didn’t want to do so unless absolutely necessary, because they would have to justify the time and money required to fix the problem to their management. </p>
<p>Yes, switching from <code>_begin­thread</code> to <code>_begin­thread­ex</code> will fix the problem. As noted, the handle returned by <code>_begin­thread</code> is useless, and any code that tries to do anything beyond test it for success is like to run into problems exactly like the one you describe. </p>
<p>We learned about some people who <a href="https://technet.microsoft.com/en-us/library/jj643252.aspx">want documentation that a bad idea is a bad idea</a>. But that documentation is already there in MSDN. They already have the paperwork they need. I couldn’t quite figure out what the customer was looking for. Did they just want a personalized version of the documentation customized just for them? </p>
<p>If that’s what you need, you can copy/paste the following paragraph. </p>
<blockquote class="m">
<p>To whom it may concern, </p>
<p>It is my recommendation that the return value from the <code>_begin­thread</code> function should be used only to determine whether the function succeeded. In particular, the handle returned by the function is of indeterminate lifetime and cannot be reliably used. </p>
<p>Sincerely, </p>
<p>Raymond Chen </p>
</blockquote>


</body>