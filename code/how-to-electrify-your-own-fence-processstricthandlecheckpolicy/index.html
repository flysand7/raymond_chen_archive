<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How to electrify your own fence: ProcessStrictHandleCheckPolicy</h1>  <!-- .entry-meta -->

<p>During process termination, if you try to enter a critical section that is owned by another thread that has already been terminated, <a href="https://blogs.msdn.microsoft.com/oldnewthing/20100122-00/?p=15193">the gates are now electrified</a>, and the kernel simply terminates your process. </p>
<p>We saw that <a href="https://blogs.msdn.microsoft.com/oldnewthing/20061211-00/?p=28763">an invalid handle error</a> and <a href="https://blogs.msdn.microsoft.com/oldnewthing/20120530-00/?p=7503">an object type mismatch error</a> both mean that your critical section is corrupted. </p>
<p>And <a href="https://blogs.msdn.microsoft.com/oldnewthing/20120530-00/?p=7503#comment-988353">as noted in a comment on the last linked article</a>, there is an option (enabled by default for Store apps) to electrify the fences and raise a exception if an application tries to use an invalid handle or an invalid type of handle (for example, trying to <code>Set­Event</code> on a semaphore). Classic Win32 applications can opt into this behavior by calling <code>Set­Process­Mitigation­Policy</code> and asking for the <code>Process­Strict­Handle­Check­Policy</code> to be turned on. </p>


</body>