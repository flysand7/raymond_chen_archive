<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">The focus rectangle says, “I’m not orange. I’m just drawn that way.”</h1>  <!-- .entry-meta -->

<p>A customer saw that the <code>Draw­Focus­Rect</code> function was drawing an orange focus rectangle when applied to highlighted text. Whose bright idea was it for the focus rectangle to be orange?</p>
<p><img decoding="async" height="150" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAARgAAACWCAIAAACKIQDHAAAC8UlEQVR42u3dwY0qMRBF0QoZIRbE
gBDpEY7JoHphSl1tH/R2X3c0Mn1mZfWPeIxk4x3J4j6SabVLta9IFiBptSBptSBptSA5aC1IIGm1
IGm1IGm1IDloLUggabVFkA5+9G0kG59IdvBrabULtSBptSBptSBptSCBpNWCpNWCpNWC5EvSggSS
VguSVlsFaepHP79m62zmehFIZiCZgWQGEkgGEkhmIJmBZAYSSAYSSGZFkGZeB+Ho+2+kn7r2kmdV
eNcOJJBAAslAAslAAslAAgkkkEACyUACyUACyUACCSSQQOr3zoaeX8N2DwdIV79rBxJIIIEEEkgg
eThAAgkkkEACCSSQQAIJJJBAAgkkkEACCSSQNodUd0UIJJDctQMJJJBA8nCABBJIIIEEEkgggQQS
SCCBBBJIIIEEEkgggQQSSM7KOxu6QBpln/Ug9Twrd+1AAgkkkEACCSSQQAIJJGcFEkgggQQSSCCB
BBJIIIEEEkgggdQR0llXhHp+ev5pOOt33u6srnjXDiSQQAIJJJBAAgkkkEACCSSQQAIJJJBAAgkk
kEACCSSQQAJpeUiuCP3r4VgP/26Q3LUDCSSQQAIJJJBAAgkkkEACCSSQQAIJJJBAAgkkkEACCSSQ
QOoIyX/r0v/h2O16kbt2IIEEEkgggQQSSCCBBBJIIIEEEkgggQQSSCCBBBJIIIEEEkggeWfDNg8H
SO7agQQSSCCBBBJIIIEEkocDJJBAAgkkkEACCSSQQAIJJJBAAgkk72zYBNJZr0ZZ7w9H07Ny1w4k
kEACCSSQQAIJJJBAclYggQQSSCCBBBJIIIEEEkgggQQSSA0h1V0RMrvYet61MwMJJAMJJDOQzEAy
AwkkAwkkM5DMQDLbHNLBP99GspkrFVrtSi1IWi1IWi1IWi1IIGm1IGm1IGm1IPmStCCBpNWCpNVW
QYrHSDbzahStdqn2FclA0mpB0mpB0mpBctBakEDSakHSakHSakFy0FqQQNJqiyD9AHvWqgsVVGeB
AAAAAElFTkSuQmCC" title="The word Hello on a blue background, with a dotted orange border." width="340"/></p>
<p>The focus rectangle says, “<a href="https://en.wikipedia.org/wiki/Jessica_Rabbit">I’m not orange. I’m just drawn that way</a>.”</p>
<p>The focus rectangle is drawn by performing an XOR operation with a checkerboard brush. The idea behind using an XOR brush was that you could erase the focus rectangle by drawing it again. And the checkerboard brush means that both horizontal and vertical lines are dotted, and the corners match.</p>
<p>Rewind back to 1983. Most computer screens were monochrome. Bitmaps were one bit per pixel. And screens were 96 DPI.</p>
<p><img decoding="async" height="160" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAXwAAACgCAAAAAAqB4j2AAABj0lEQVR42u3cMQ6DQAwEwPv/p0lH
RRSiM8bnmy1XKFhDKDBRxjhznNFldxDgw9fBh6+DD18HH75uvjskOZffd4EPX+DDF/jwBT58mcZ3
GdwD8AU+fIEPX+DDF/g98P9/FJ55jH7r8b3ofPDhw4cPHz58+PDhw4cP/4n5BvzsFQt8+PDhw4cP
Hz58+PDhw4+c1HrBbgc+fPjw4cOHDx8+fPjwe+BXWi+Mm3kLP2a+orsd+PDhw4cPHz58+PDhw18e
P+Z0M2NtfBx8+PDhw4cPHz58+PDhw3/iuNfWC7tdzFK7Hfjw4cOHDx8+fPjw4cNvhB/9Ejxj6Nzz
ltrtwIcPHz58+PDhw4cPHz78xd7hdsYvv9uBDx8+fPjw4cOHDx8+/EXx11kvNDwOPnz48OHDhw8f
Pnz48OG3eof7Y6yQT6k0X6ndDnz48OHDhw8fPnz48OFv81/KEp+g3wkIfPgCH77Ahy/w4cvX52Qs
7gH4Ah++wIcv8OEL/JXxr66DLqeDAB++Dj58HXz4OvjwdYHdB5o1rjcbyhZbAAAAAElFTkSuQmCC" title="The word Hello in black on a white background, with a dotted black border." width="380"/></p>
<p>In this world, XOR is a perfectly reasonable thing to do, since it looks good against both white¹ and black backgrounds.</p>
<p><img decoding="async" height="160" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAXwAAACgCAAAAAAqB4j2AAABgElEQVR42u3cQQ6FMAgFQO9/ad25
NDGlLYV5S6J+HOKGJv+631xv1NbUIMCHrwYfvhp8+Grw4atF4svqGAN8+AIfvsCHL/Dhyxx8c/AR
wBf48AU+fIEPX+D3Gs3/IY3cu6Ln/f3Bhw8fPnz48OHDhw8fPvxI/HkNwh/8CODDhw8fPnz48OHD
hw8f/oYXgW+3Ax8+fPjw4cOHDx8+fPjOcL/viHlKpv6S7nbgw4cPHz58+PDhw4cP/3j8mJ8baavv
dfDhw4cPHz58+PDhw4cPPxJ//3qh2zBT7Xbgw4cPHz58+PDhw4cPvxB+9CH4/qZL73bgw4cPHz58
+PDhw4cPH/5hZ7iV8dPvduDDhw8fPnz48OHDhw//UPxz1gv1roMPHz58+PDhw4cPHz58+LXOcL/v
iHlKpv5S7Xbgw4cPHz58+PDhw4cPv81/KUt8DAk+fIEPX+DDF/jwZQ6+OfgI4At8+AIfvsCHL/A7
jEFtTQ0CfPhq8OGrwYevBh++2nDtAbIV8hBDlnCWAAAAAElFTkSuQmCC" title="The word Hello in white on a black background, with a dotted white border." width="380"/></p>
<p>A simple pattern of alternating white and black pixels gets you the dotted-line effect.</p>
<p>Of course, weird things happened if the focus rectangle was drawn against a non-solid background, but given the limitations of the hardware, you didn’t really have too much choice.</p>
<p>Fast-forward to the days of high-density 32-bit-per-pixel displays. That simple algorithm doesn’t produce results that are quite so pretty any more. For one thing, a single pixel dotted line is barely visible on high-density displays. And for another thing, XOR’ing colored pixels can produce strange effects.</p>
<p>In our case, what happened is that we took the blue color <code>#0078D7</code> and flipped all the bits, producing <code>#FF8728</code>, which is bright orange.</p>
<p>That’s where the orange comes from. The focus rectangle doesn’t draw orange. It just flips the pixels that are already there, and blue flips to orange.</p>
<p>The <code>Draw­Focus­Rect</code> function can’t do anything about the XOR brush, because that would break compatibility with code that used a second <code>Draw­Focus­Rect</code> to erase the focus rectangle. But at least it can do a little bit to help with the dotted rectangle: The thickness of the dotted rectangle is controlled by an accessibility setting. In <i>Control Panel</i>, under <i>Ease of Access</i>, <i>Make the computer easier to see</i>, you can check “Make the focus rectangle thicker”, which makes the focus rectangle two pixels thick instead of just being a dotted line.</p>
<p>Programs which draw their own focus indicators can match the accessibility setting by using the <code>SPI_<wbr/>GET­FOCUS­BORDER­WIDTH</code> and <code>SPI_<wbr/>GET­FOCUS­BORDER­HEIGHT</code> system metrics.</p>
<p><b>Bonus chatter</b>: The blinking line that indicates where typing will be inserted is called the <i>caret</i>, and it too is drawn by XOR. This works fine when the caret is against a white or black background, but again, if it’s against a colored background, things can get a little weird.</p>
<p>¹ Or, more likely, P1 phosphor green and black, or P3 phosphor amber and black.</p>


</body>