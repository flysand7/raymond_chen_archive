<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Annotating function parameters and using PREfast to check them</h1>  <!-- .entry-meta -->

<p>Via the suggestion box, Sys64738 asks, <a href="http://blogs.msdn.com/b/oldnewthing/archive/2007/05/23/407234.aspx#1499080"> whether I think is a good C/C++ programming style to add IN and OUT to function prototypes</a>.
 Remember, this is my opinion. Your opinion may validly differ.
 I would go beyond just IN and OUT and step up to <a href="http://msdn.microsoft.com/en-us/library/aa383701.aspx"> SAL annotations</a>, which describe the semantics of function parameters in more detail than simply IN and OUT. For example, the <code>__out_ecount</code> annotation lets you specify not only that the buffer is an output parameter, but also lets you specify how big the buffer is.
 This added expressiveness is used by tools like <a href="http://msdn.microsoft.com/en-us/library/ff550543.aspx"> PREfast</a> and its user-mode equivalent the <a href="http://msdn.microsoft.com/en-us/library/d3bbz7tz.aspx"> C/C++ Code Analysis tool</a>. These tools study your source code and attempt to find errors like writing past the end of an output buffer, passing the wrong buffer size for an output parameter, or writing to an input buffer.
 One question that often comes up when people start adding SAL annotations to their code is “I have a function whose parameters are used in a manner that isn’t neatly covered by an existing annotation. How do I annotate it?” If you ask them to describe the parameters they are having trouble with, you often find that they don’t have an easy annotation because they are too complicated. “Well, this is a null-terminated input string buffer, unless the <code>SET</code> flag set, in which case it’s an output buffer with length specified by the <code>cchBuf</code> parameter, and the buffer size is specified in <code>CHAR</code>s unless the <code>FN_UNICODE</code> flag is set in the <code>dwFlags</code> parameter, in which case the size is in <code>WCHAR</code>s.”</p>
<p> One lesson we learned in Windows is that if your function is so complicated that the annotation language has trouble expressing it, then that might be a clue that your function is so complicated that human beings can’t understand it either. The answer to “How do I annotate it?” is therefore “Don’t try. Simplify your interface instead.” (Of course, if the function must be kept around for compatibility reasons, then you are stuck with a complicated annotation.) </p>


</body>