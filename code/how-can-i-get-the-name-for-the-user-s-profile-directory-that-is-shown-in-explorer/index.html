<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How can I get the name for the user’s profile directory that is shown in Explorer?</h1>  <!-- .entry-meta -->

<p>A customer wanted to know how they could get the <code>SHGet­Localized­Name</code> function to work. Fortunately, they gave a specific definition of “work”. </p>
<blockquote class="q"><p>We are populating a list of folders, and we want the names to be the same names that appear in Explorer. We are diong it by calling <code>SHGet­Localized­Name</code>, and if it succeeds, doing a <code>Load­Library­Ex</code> with <code>LOAD_LIBRARY_AS_DATAFILE</code>, and then a <code>Load­String</code>. (If the call to <code>SHGet­Localized­Name</code> fails, then we just use the raw file system name.) This works for the most part, but not for the user profile. How can we get the correct name for the user profile folder? </p></blockquote>
<p>The user profile name is not a localized name, which is why <code>SHGet­Localized­Name</code> doesn’t give you any information about it. Instead, that name is dynamically generated based on the user whose profile you are looking at. (It’s not like there’s a giant <code>usernames.dll</code> which includes the name of every possible user on the planet, and <code>SHGet­Localized­Name</code> says “Oh, yeah, the user is Raymond Chen? That’s string number 31415 in <code>usernames.dll</code>.”) </p>
<p>The way to get the name that Explorer displays for an item is to ask the same data source that Explorer uses: the shell namespace. </p>
<p>And hey, how about that, I already wrote a sample program that shows how to do this, just in the context of a different question, so I’m going to incorporate the existing program by reference. <a href="https://blogs.msdn.microsoft.com/oldnewthing/20151019-00/?p=91331">Here you go</a>. </p>


</body>