<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">ReadDirectoryChangesW reads directory changes, but what if the directory doesn't change?</h1>  <!-- .entry-meta -->

<p>The <code>Read­Directory­ChangesW</code> function reads changes to a directory. But not all changes that happen to files in a directory result in changes to the directory.
 Now, it so happens that nearly all changes to a file in a directory really do result in something happening to the file’s directory entry. If you write to a file, the last-write time in the directory entry changes. If you rename a file, the name in the directory entry changes. If you create a file, a new directory entry is created.
 But there are some changes that do not affect the directory entry. I’ve heard rumors that if you write to a file via a memory-mapped view, that will not update the last-write time in the directory entry. (I don’t know if it’s true, but if it’s not, then just pick some other file-modifying operation that doesn’t affect the directory entry, like modifying the contents of a file through a hard link in another directory, or explicitly suppressing file timestamp changes by calling <code>Set­File­Time</code> with a timestamp of <code>0xFFFFFFFF`FFFFFFFF</code>.) The point is that since these changes have no effect on the directory, they are not recognized by <code>Read­Directory­ChangesW</code>. The <code>Read­Directory­ChangesW</code> function tells you about changes to the directory; if something happens that doesn’t change the directory, then <code>Read­Directory­ChangesW</code> will just shrug its shoulders and say, “Hey, not my job.”
 If you need to track all changes, even those which do not result in changes to the directory, you need to look at other techniques like the <a href="http://msdn.microsoft.com/aa363798.aspx"> change journal</a> (a.k.a. USN journal).
 The intended purpose of the <code>Read­Directory­ChangesW</code> function is to assist programs like Windows Explorer which display the contents of a directory. If something happens that results in a change to the directory listing, then it is reported by <code>Read­Directory­ChangesW</code>. In other words, <code>Read­Directory­ChangesW</code> tells you when the result of a <code>Find­First­File</code>/<code>Find­Next­File</code> loop changes. The intended usage pattern is doing a <code>Find­First­File</code>/<code>Find­Next­File</code> to collect all the directory entries, and then using the results from <code>Read­Directory­ChangesW</code> to update that collection incrementally. 
 In other words, <code>Read­Directory­ChangesW</code> allows you to optimize a directory-viewing tool so it doesn’t have to do full enumerations all the time.</p>
<p> This design philosophy also explains why, if too many changes have taken place in the directory between calls to <code>Read­Directory­ChangesW</code>, the function will fail with an error called <code>ERROR_NOTIFY_ENUM_DIR</code>. It’s telling you, “Whoa, like so much happened that I couldn’t keep track of it all, so you’ll just have to go back and do another <code>Find­First­File</code>/<code>Find­Next­File</code> loop.” </p>


</body>