<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Investigating an app compat problem: Part 1: The initial plunge</h1>  <!-- .entry-meta -->


<p> (function () {     var arrowAngle = Math.PI / 12;     var arrowLength = 10;     function vec2(x, y) {         this.x = x;         this.y = y;     }     vec2.prototype.add = function (v) {         return new vec2(this.x + v.x, this.y + v.y);     };     vec2.prototype.sub = function (v) {         return new vec2(this.x – v.x, this.y – v.y);     }     vec2.prototype.magnitude = function () {         return Math.sqrt(this.x * this.x + this.y * this.y);     };     vec2.prototype.scale = function (scale) {         return new vec2(this.x * scale, this.y * scale);     };     vec2.prototype.rotate = function (theta) {         var sth = Math.sin(theta);         var cth = Math.cos(theta);         return new vec2(this.x * cth – this.y * sth, this.x * sth + this.y * cth);     };     function directionVector(v0, v1, l) {         var d = v1.sub(v0);         return d.scale((l || 1) / (d.magnitude() || 1));     }     function drawArrowHead(ctx, v0, v1) {         var u = directionVector(v1, v0, arrowLength);         ctx.beginPath();         ctx.moveTo(v1.x, v1.y);         var v = v1.add(u.rotate(arrowAngle));         ctx.lineTo(v.x, v.y);         v = v1.add(u.rotate(-arrowAngle));         ctx.lineTo(v.x, v.y);         ctx.lineTo(ctx, v1.x, v1.y);         ctx.fill();     }     function getAttachment(ctx, element, attach) {         var v = new vec2(element.offsetLeft – ctx.canvas.offsetLeft, element.offsetTop – ctx.canvas.offsetTop);         var mag = parseInt(attach) * 10;         if (isNaN(mag)) mag = 10;         var dv = new vec2(-mag, -mag);         if (attach.indexOf(“S”) &gt;= 0) {             v.y += element.offsetHeight;             dv.y = mag;         } else if (attach.indexOf(“N”) = 0) {             v.x += element.offsetWidth;             dv.x = mag;         } else if (attach.indexOf(“W”) &lt; 0) {             v.x += element.offsetWidth / 2;             dv.x = 0;         }         return [v, v.add(dv)];     }     function onresize() {         var thisPost = document.getElementById("appCompatPart1");         var canvas = thisPost.getElementsByTagName("canvas")[0];         if (!canvas.getContext) return;         canvas.width = thisPost.offsetWidth;         canvas.height = thisPost.offsetHeight;         var ctx = canvas.getContext("2d");         ctx.fillStyle = "#404040";         Array.prototype.forEach.call(thisPost.querySelectorAll("[data-to]"), function (source) {             var ids = source.getAttribute("data-to");             ids.split(" ").forEach(function (id) {                 var opt = id.split(":"); // target:connector:attachStart:attachEnd                 var target = thisPost.querySelector("#" + opt[0]);                 var vStart = getAttachment(ctx, source, opt[2]);                 var vEnd = getAttachment(ctx, target, opt[3]);                 var v0 = vStart[0];                 var v1 = vStart[1];                 var v2 = vEnd[1];                 var v3 = vEnd[0];                 ctx.beginPath();                 ctx.moveTo(v0.x, v0.y);                 switch (opt[1]) {                     case "L":                         ctx.lineTo(v3.x, v3.y);                         v2 = v0;                         break;                     case "C":                         ctx.bezierCurveTo(v1.x, v1.y, v2.x, v2.y, v3.x, v3.y);                         break;                 }                 ctx.stroke();                 drawArrowHead(ctx, v2, v3);             });         });     }     if (window.addEventListener) {         window.addEventListener("resize", onresize);         onresize();     } })(); </p>


</body>