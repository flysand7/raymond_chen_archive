<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why do I sometimes get classic buttons and sometimes themed buttons depending on the host process?</h1>  <!-- .entry-meta -->

<p>A customer reported that their printer configuration property sheet page looked different depending on the host process. In some processes, the printer configuration dialog had the classic look of Windows 2000, but in other processes it has the themed look of Windows XP and later versions.</p>
<blockquote class="q"><p> The printer driver calls the <code>Create­Property­Sheet­PageW</code> to create the property sheet page that contains the push-button, radio-button, and other controls. We’ve confirmed that we call the function with the same parameters each time, but the results are different depending on which program is doing the printing. We’ve confirmed that both applications are using version 6.0 of the common controls library. Can you provide pointers for investigating why we are getting the old-school look sometimes? </p></blockquote>
<p> It’s clear that the problem is that the property sheet page is being created with a different activation context depending on the host process. If the activation context is a v6 context, then you get the themed buttons; if the activation context is a v5 context, then you get the classic buttons. The fact that version 6.0 of the common controls library is loaded by the process is not relevant; what’s relevant is which version is active at the time the dialog is created, since that’s the time the class names are resolved.
 If the problem were with a regular dialog box, then you can explicitly activate the v6 context before calling <code>Dialog­Box</code>, or you can use <a href="http://msdn.microsoft.com/library/bb773175#mmc"> isolation awareness</a> to have the activation code generated for you.
 However, the case here is a property sheet page. Since property sheet pages are created on demand (when the user selects the page), you don’t have direct control over the code that calls <code>Dialog­Box</code> in order to activate your v6 manifest. Instead, use the <code>hAct­Ctx</code> member of the <code>PROP­SHEET­PAGE</code> structure and set the <code>PSP_USE­FUSION­CONTEXT</code> flag in the <code>dwFlags</code>.</p>
<p> <b>Trivia</b>: <i>Fusion</i> was the code name for the feature which includes things like <a href="http://msdn.microsoft.com/library/dd408052"> isolated applications</a>, <a href="http://msdn.microsoft.com/library/aa374191"> application manifests</a> and <a href="http://msdn.microsoft.com/library/ms682600"> redirection files</a>. And because they were apparently a bunch of nerds (<i>quelle surprise</i>!) they named the initial version <i>Hydrogen</i>. </p>


</body>