<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Passing the incorrect object type for a handle, how bad is it?</h1>  <!-- .entry-meta -->

<p>A customer asked a somewhat strange question: “We are calling <code>Set­Event</code> but passing the handle to a waitable timer. Application Verifier reports, “<a href="http://msdn.microsoft.com/en-us/library/ms220969(v=VS.90).aspx">Incorrect object type for handle</a>.” But the code works well. We want to know the risks of passing the wrong object type to <code>Set­Event</code>. Is the recommendation only to pass handles of type “Event” to <code>Set­Event</code>?
 Let’s answer those questions in reverse order.
 Yes, the recommendation is only to pass handles of type “Event” to <code>Set­Event</code>, just as the recommendation is only to pass handles of type “Semaphore” to <code>Release­Semaphore</code>, and more generally, only to pass valid parameters to functions.
 What is the risk of passing the wrong object type? You’re lucky that the kernel does object type validation before proceeding, so your error is caught during parameter validation and the function fails with the error <code>ERROR_INVALID_HANDLE</code> (or status code <code>STATUS_OBJECT_TYPE_MISMATCH</code>, if the function returns status codes instead of error codes).
 Of course, if you are encountering this problem only because you are using a handle after closing it (and then the handle got recycled as a timer handle), then you merely got lucky. Maybe tomorrow you won’t be so lucky, and the handle will get recycled as another unrelated event. Tomorrow, your <code>Set­Event</code> call will succeed and <i>set some other guy’s event</i>. This will probably cause that other guy to get really confused. “This event is set when the modulator has finished calibrating. But the event is getting signaled before the calibration is complete, so my code ends up using an uncalibrated modulator! I set a breakpoint on my <code>Set­Event</code> call, and it never fires, yet the event is set. Help me debug this. I’ve spent a week trying to figure out what’s wrong!”</p>
<p> As to the final remark, “But the code works well,” it’s not clear what the customer meant by that. What does “works well” mean in this context? Do they mean, “The event is successfully set even though it’s not an event”? How can you successfully perform an event operation on something that isn’t an event? Or perhaps they mean, “Our code seems to work okay in spite of this mistake.” The operative phrase there is “seems to”. It may seem to work well, but someday it won’t, and at the most inconvenient time. </p>


</body>