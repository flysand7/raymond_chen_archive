<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why not auto convert week-based time zone information to date-based?</h1>  <!-- .entry-meta -->

<p>When I described the two ways that the <code>TIME_ZONE_INFORMATION</code> structure represents the rules for daylight saving time, commenter Voo <a href="http://blogs.msdn.com/b/oldnewthing/archive/2011/03/11/10139574.aspx#10140261">argued</a> (and I hope I interpreted the message correctly) that either there should be two functions, one for each of the ways, or have <code>Get­Time­Zone­Information­For­Year</code> function calculate the day automatically from the week and return that. That way, callers always see the correct day. </p>
<p>Okay, there are multiple things in play here, but they all boil down to “no code is an island”. </p>
<p>If all you needed to support was a way to answer the question “When does daylight saving time start and end in this specific year”, then certainly the <var>n</var>th week rules could be interpreted by the <code>Get­Time­Zone­Information­For­Year</code> function, so that all that came out of the function was a specific date and time. </p>
<p>But that’s not the only function that deals with time zone information. For starters, we have <code>Get­Time­Zone­Information</code>. Since this function is not dependent on the year, it wouldn’t know what year to use to calculate the date on which the third Sunday falls. It would have to leave the structure in generic form. </p>
<p>Now, maybe you say, “Yeah, these two functions return the same structure, and you just have to know that one of the functions will autoconvert and the other won’t.” Some people will find that confusing. </p>
<p>Maybe you solve that problem by saying, “These two functions return different structures, reflecting their different natures.” Some people will be frustrated by that, because they will have to write two versions of the same function, one for each structure. </p>
<p>(I’m not event going to bother adding <code>Get­Dynamic­Time­Zone­Information</code>. to the mix.) </p>
<p>And then there’s the question of whether it’s okay that the <code>Get</code> function returns a structure that cannot be passed into the corresponding <code>Set</code> function. (Which is a bit of a pointless question here, seeing as there is no <code>Set­Time­Zone­Information­For­Year</code> function, but maybe someday it will show up.) It also means that you cannot compare two <code>TIME_ZONE_INFORMATION</code> structures from different years to see whether the time zone transition rules are the same in those years. (This is, admitted, a fringe scenario.) </p>
<p>Two functions seems the less crazy way out. There would be a <code>Get­Unexpanded­Time­Zone­Information­For­Year</code> which returns the unprocesed information and a <code>Get­Expanded­Time­Zone­Information­For­Year</code> that does the date lookup for the appropriate year. Though personally, I would keep <code>Get­Time­Zone­Information­For­Year</code> as-is and add a <code>Calculate­Daylight­Saving­Transition­Dates­For­Year</code> function. That way, you could use it to expand other things. </p>
<p>I suspect no such <code>Calculate­Daylight­Saving­Transition­Dates­For­Year</code> function exists because the kernel folks have a general bias against writing functions that you could have written yourself, so that they can focus on writing functions that you <i>can’t</i> write yourself because it requires special access to things that only the kernel has access to. (Like querying the current time zone.)  </p>


</body>