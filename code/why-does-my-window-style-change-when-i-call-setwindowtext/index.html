<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why does my window style change when I call SetWindowText?</h1>  <!-- .entry-meta -->

<p>A customer observed some strange behavior with window styles:</p>
<blockquote class="q"><p> We ran some weird behavior: Calling the <code>Set­Window­Text</code> function causes a change in window styles. Specifically, calling <code>Set­Window­Text</code> results in the <code>WM_STYLE­CHANGING</code> and <code>WM_STYLE­CHANGED</code> messages, and sometimes the result is that the <code>WS_TAB­STOP</code> style is removed. Is this a bug? What would cause this? </p></blockquote>
<p> The <code>Set­Window­Text</code> message sends the <code>WM_SET­TEXT</code> message to the control, at which point anything that happens is the window’s own responsibility. If it wants to change styles based on the text you sent, then that’s what happens. The window manager doesn’t do anything special to force it to happen or to prevent it.</p>
<blockquote class="q"><p> That’s weird, because I’m not even listening for <code>WM_SET­TEXT</code> messages. I also verified that there is no call into my code during the call to the the <code>Set­Window­Text</code> function. </p></blockquote>
<p> I’m assuming that the window belongs to the same process as the caller. <a href="http://blogs.msdn.com/b/oldnewthing/archive/2003/08/21/54675.aspx"> If the window belongs to another process, then the rules are different</a>.</p>
<blockquote class="q"><p> I’m changing the text of a window created by the same thread. </p></blockquote>
<p> Okay, so let’s see what we have so far. The customer is calling the <code>Set­Window­Text</code> function to change the text of a window created on the same thread. There is no handler for the <code>WM_SET­TEXT</code> message, and yet the window style is changing. At this point, you might start looking for more obscure sources for the problem, like say a global hook of some sort. While I considered the possibilities, the customer added,</p>
<blockquote class="q"><p> It may be worth noting that I’m using the <code>Sys­Link</code>. </p></blockquote>
<p> Okay, now things are starting to make sense, and it didn’t help that the customer provided misleading information in the description of the problem. For example, when the customer wrote, “There is no handler for the <code>WM_SET­TEXT</code> message,” the customer was not referring to the window whose window text is changing but to some other unrelated window.
 It’s like responding to the statement “A confirmation letter should have been sent to the account holder” with “I never got the confirmation letter,” and then the person spends another day trying to figure out why the confirmation letter was never sent before you casually mention, “Oh, I’m not the account holder.”
 The <code>WM_SET­TEXT</code> message is sent to the window you passed to <code>Set­Window­Text</code>; in this case, it’s the <code>Sys­Link</code> window. It is therefore the window procedure of the <code>Sys­Link</code> window that is relevant here.</p>
<p> The <code>Sys­Link</code> control remembers whether it was <a href="http://msdn.microsoft.com/library/bb760706(VS.85).aspx#syslink_creation"> originally created with the <code>WS_TAB­STOP</code></a>, and if the markup it is given has no tab stops, then it removes the style; if the markup has tab stops, then it re-adds the style. </p>
<blockquote class="q"><p> How do I add a tab stop to a string? I couldn’t find any reference to it and all my guesses failed. </p></blockquote>
<p> The tab stops in question are the hyperlinks you added when you used the <code>&lt;A&gt;...&lt;/A&gt;</code> notation. If the text has no hyperlinks, then the control removes the <code>WS_TAB­STOP</code> style because it is no longer something you can tab to. </p>


</body>