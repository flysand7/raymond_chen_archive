<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Why do I get a spurious WM_MOUSEMOVE message whenever Resource Manager is running?</h1>  <!-- .entry-meta -->

<p>We saw some time ago that the operating system generates spurious <code>WM_MOUSE­MOVE</code> messages <a href="https://blogs.msdn.microsoft.com/oldnewthing/20031001-00/?p=42343">as a side effect of mouse cursor recalculations</a>. In a sense, the way to kick-start a mouse cursor recalculation is to pretend that the mouse moved. And if you see a continuous stream of spurious <code>WM_MOUSE­MOVE</code> messages, then it suggests that there is <a href="https://devblogs.microsoft.com/oldnewthing/">some continuous activity</a> that is triggering mouse cursor recalculation. </p>
<p>A customer discovered that their program receive spurious <code>WM_MOUSE­MOVE</code> messages at a rate of approximately one every two seconds. They were able to narrow down the conditions and found that it occurred when the Hyper-V Manager or Resource Monitor were running. What is it about those two programs that is causing all the spurious mouse activity? </p>
<p>The common thread is that these program have a continuously updating window that refreshes (you guessed it) every two seconds. At each refresh, the programs do a <code>WM_SET­REDRAW</code> to disable redrawing in their window, then they update all their stuff, and then they do another <code>WM_SET­REDRAW</code> to re-enable redrawing. </p>
<p>We saw some time ago that <a href="https://blogs.msdn.microsoft.com/oldnewthing/20110124-00/?p=11683">the window manager provides a default implementation of the <code>WM_SET­REDRAW</code> message</a> which makes the window pseudo-invisible when redraw is disabled, and then undoes all the weird fakery when redraw is re-enabled. </p>
<p>Undoing the weird fakery is where the spurious <code>WM_MOUSE­MOVE</code> messages are coming from. Making a window pseudo-visible means, among other things, that if the cursor is inside the window that just became pseudo-visible, the window needs to be told, “Hey, you have the mouse cursor. Set the cursor to something appropriate.” </p>
<p>And that’s what’s triggering the spurious mouse move messages every two seconds. </p>
<p>If processing mouse-move messages is expensive for your program, you can watch to see if you receive a mouse move message that matches the coordinates of the previous message. If so, and your program state hasn’t changed between the two messages, then ignore the spurious message. (Of course, if your program state <i>has</i> changed, then you will want to reprocess the message, because the answer to the question might be different the second time around.) </p>


</body>