<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How can I detect whether the user is logging off?</h1>  <!-- .entry-meta -->

<p>There may be cases where you want to know whether the user is logging off. For example, your program might be responding to external events by (say) launching a helper program, but you don’t want to do that if a logoff is in progress. </p>
<p>The way to find out is hidden in <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms724385(v=vs.85).aspx">the <code>Get­System­Metrics</code> function</a>, which is admittedly a rather non-obvious place to put it. </p>
<pre>
if (GetSystemMetrics(SM_SHUTTINGDOWN)) {
 // user is logging off, don't start anything new
}
</pre>
<p>Compounding the confusion is that the flag is called “shutting down”, but in fact it reports whether the user is logging off (which in today’s parlance is called <i>signing out</i>). The logout may be part of a shutdown, or it might not. </p>


</body>