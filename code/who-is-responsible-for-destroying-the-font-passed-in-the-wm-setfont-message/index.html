<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">Who is responsible for destroying the font passed in the WM_SETFONT message?</h1>  <!-- .entry-meta -->

<p>The <code>WM_SETFONT</code> message tells a control which font you would like the control to use for its text. This message is a convention, not a rule. For example, our <a href="http://blogs.msdn.com/oldnewthing/archive/2003/07/23/54576.aspx"> scratch program</a> doesn’t pay attention to the <code>WM_SETFONT</code> message. If somebody sends it a <code>WM_SETFONT</code>, nothing happens. The scratch program just ignores the caller and uses whatever font it wants.</p>
<p> Although supporting the <code>WM_SETFONT</code> message is optional, if you do choose to support it, you would be well-served to adhere to the following convention: The <code>WM_SETFONT</code> message does not alter font ownership. In other words, whoever was responsible for destroying the font before the <code>WM_SETFONT</code> message is sent is still responsible for destroying it after the message is sent. </p>
<p> Corollary: If you tell somebody to use a specific font, don’t destroy the font while they’re still using it, because they’re counting on you to keep the font valid. </p>
<p> Example: The dialog manager creates the dialog box font and sends the <code>WM_SETFONT</code> message to each control to tell it what font it should use. The dialog manager keeps the font valid until the dialog box is destroyed, at which point the font is destroyed as well. </p>
<p> But what font does a control use before it receives a <code>WM_SETFONT</code> message? Whatever font it wants. Some controls have particular ideas about the font they will use by default; the list view, for example, uses the icon label font. In those cases, it is the control’s responsibility to destroy that default font when the control is destroyed. This is true even if the parent window creates another font and sends a <code>WM_SETFONT</code> to change to that font. There are now two fonts involved: the original default font (which is the control’s responsibility to destroy) and the font set by <code>WM_SETFONT</code> (which is the parent’s responsibility to destroy). </p>
<p> Now this may all sound complicated, but remember the basic rule: The <code>WM_SETFONT</code> message does not change who is responsible for destroying a font. Let’s look at that scenario again, but take out the <code>WM_SETFONT</code> message. (I’ve crossed it out below.) A control creates a default font. The parent window creates another font. <strike>The parent window sends the <code>WM_SETFONT</code> message to the control.</strike> </p>
<p> Now, without that crossed-out sentence, the ownership rules are crystal clear. The control is responsible for destroying the default font it created, and the parent is responsible for destroying its own font. </p>
<p> The same principle applies to the <code>WM_GETFONT</code> message. You can send <code>WM_SETFONT</code> and <code>WM_GETFONT</code> messages all day long; it has no effect on who is responsible for destroying the font at the end of the day. </p>


</body>