<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">If you want to consume all the virtual address space, well, then go ahead and consume it, you don’t need my help</h1>  <!-- .entry-meta -->

<p>Commenter <a href="http://matthew.chaboud.com/"> Matthew Chaboud</a> asks <a href="http://blogs.msdn.com/oldnewthing/pages/407234.aspx#605479"> if there’s an easy way to consume all the virtual address space below 4GB</a>, short of, well, actually allocating it. “It seems like there should be a cleaner way to do this.”</p>
<p> If you want to consume all the virtual address space, then call <code>VirtualAlloc</code> until you turn blue. Programs shouldn’t care what address they get back from a memory allocation function; they should handle values below 2GB and <a href="http://blogs.msdn.com/oldnewthing/archive/2004/08/12/213468.aspx"> above 2GB</a> with equal facility. </p>
<p> It’s not like there’s a <code>ConsumeAllAvailableVirtualAddressSpaceAndExhaustTheHeap</code> function. (Is there a <code>AllocateAllRemainingDiskSpaceAndFillExistingFilesWithZeroes</code> function?) What would be the point of such a function? Once you call it, you have run out of memory! </p>
<p> If Mr. Chaboud is talking about keeping programs away from bottom 4GB of virtual address space on a 64-bit machine, then a much easier way to do this is to <a href="http://www.microsoft.com/whdc/system/platform/server/PAE/PAEdrv.mspx"> set the <code>AllocationPreference</code></a> configuration setting to specify that memory should be allocated from high addresses first. (But I don’t think that’s the scenario that prompted the original question, because on 64-bit Windows, the default heap is above the 4GB boundary, so there would be no need to exhaust the heap in order to consume the memory at virtual addresses below 4GB.) </p>
<p> <b>Correction</b>: <a href="http://blogs.msdn.com/oldnewthing/archive/2009/06/29/9807826.aspx#9809341"> Pavel Lebedinsky  points out</a> that the default heap is below 4GB on 64-bit machines. It used to be above the 4GB boundary on earlier versions of 64-bit Windows, but I guess they changed it. </p>


</body>