<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">How can I tell that somebody used the MAKEINTRESOURCE macro to smuggle an integer inside a pointer?</h1>  <!-- .entry-meta -->

<p>Many functions and interfaces provide the option of passing either a string or an integer. The parameter is formally declared as a string, and if you want to pass an integer, you smuggle the integer inside a pointer by using the <code>MAKE­INT­RESOURCE</code> macro. For example, the <code>Find­Resource</code> function lets you load an resource specified by integer identifier by passing the identifier in the form <code>MAKE­INT­RESOURCE(ID)</code>. You can tell that it was the resource-loading functions who created the macro in the first place, since the name of the macro is “make integer <i>resource</i>.”
 But other functions use the <code>MAKE­INT­RESOURCE</code> convention, too. The <code>Get­Proc­Address</code> function  lets you obtain a function exported by ordinal if you smuggle the ordinal inside a pointer: <code>Get­Proc­Address(hModule, MAKE­INT­RESOURCEA(ordinal))</code>. (You have to use <code>MAKE­INT­RESOURCEA</code> because  <code>Get­Proc­Address</code> explicitly takes an ANSI string.)
 What if you’re implementing a function whose interface requires you to accept both strings and integers-smuggled-inside strings? For example, maybe you’re implementing <code>IContext­Menu::Invoke­Command</code>, which needs to look at the <code>CM­INVOKE­COMMAND­INFO.lpVerb</code> member and determine whether the invoker passed a string or a menu offset.
 You can use the <code>IS_INT­RESOURCE</code> macro. It will return non-<code>FALSE</code> if the pointer you passed is really an integer smuggled inside a pointer.</p>
<p> How does <code>MAKE­INT­RESOURCE</code> work? It just stashes the integer in the bottom 16 bits of a pointer, leaving the upper bits zero. This relies on the convention that the first 64<a href="http://blogs.msdn.com/b/oldnewthing/archive/2009/06/11/9725386.aspx">KB</a> of address space is never mapped to valid memory, a convention that is enforced starting in Windows 7. </p>


</body>