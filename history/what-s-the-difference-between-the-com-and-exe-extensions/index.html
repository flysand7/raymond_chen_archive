<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">What’s the difference between the COM and EXE extensions?</h1>  <!-- .entry-meta -->

<p>Commenter Koro asks <a href="http://blogs.msdn.com/oldnewthing/pages/407234.aspx#503035"> why you can rename a COM file to EXE without any apparent ill effects</a>. (James MAstros <a href="http://blogs.msdn.com/oldnewthing/archive/2006/01/30/519388.aspx#519544"> asked a similar question</a>, though there are additional issues in James’ question which I will take up at a later date.)</p>
<p>Initially, the only programs that existed were COM files. The format of a COM file is… um, none. There is no format. A COM file is just a memory image. This “format” was inherited from CP/M. To load a COM file, the program loader merely sucked the file into memory unchanged and then jumped to the first byte. No fixups, no checksum, nothing. Just load and go.</p>
<p>The COM file format had many problems, among which was that programs could not be bigger than about 64KB. To address these limitations, the EXE file format was introduced. The header of an EXE file begins with <a href="https://devblogs.microsoft.com/oldnewthing/20060130-00/?p=32483" title="Why does a corrupted binary sometimes result in Program too big to fit in memory?"> the magic letters “MZ”</a> and continues with other information that the program loader uses to load the program into memory and prepare it for execution.</p>
<p>And there things lay, with COM files being “raw memory images” and EXE files being “structured”, and the distinction was rigidly maintained. If you renamed an EXE file to COM, the operating system would try to execute the header as if it were machine code (which didn’t get you very far), and conversely if you renamed a COM file to EXE, the program loader would reject it because the magic MZ header was missing.</p>
<p>So when did the program loader change to ignore the extension entirely and just use the presence or absence of an MZ header to determine what type of program it is? Compatibility, of course.</p>
<p>Over time, programs like <code>FORMAT.COM</code>, <code>EDIT.COM</code>, and even <code>COMMAND.COM</code> grew larger than about 64KB. Under the original rules, that meant that the extension had to be changed to EXE, but doing so introduced a compatibility problem. After all, since the files had been COM files up until then, programs or batch files that wanted to, say, spawn a command interpreter, would try to execute <code>COMMAND.COM</code>. If the command interpreter were renamed to <code>COMMAND.EXE</code>, these programs which hard-coded the program name would stop working since there was no <code>COMMAND.COM</code> any more.</p>
<p>Making the program loader more flexible meant that these “well-known programs” could retain their COM extension while no longer being constrained by the “It all must fit into 64KB” limitation of COM files.</p>
<p>But wait, what if a COM program just happened to begin with the letters MZ? Fortunately, that never happened, because the machine code for “MZ” disassembles as follows:</p>
<pre>0100 4D            DEC     BP
0101 5A            POP     DX
</pre>
<p>The first instruction decrements a register whose initial value is undefined, and the second instruction underflows the stack. No sane program would begin with two undefined operations.</p>


</body>