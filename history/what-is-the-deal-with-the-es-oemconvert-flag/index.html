<body style=max-width:80ch;margin:auto>
<h1 class="entry-title" style="margin-bottom:15px;">What is the deal with the ES_OEMCONVERT flag?</h1>  <!-- .entry-meta -->

<p>The <a href="http://msdn.microsoft.com/library/en-us/shellcc/platform/commctls/editcontrols/editcontrolreference/editcontrolstyles.asp"> <code>ES_OEMCONVERT</code></a> edit control style is a holdover from 16-bit Windows. <a href="http://msdn.microsoft.com/library/en-us/dnwui/html/msdn_editctls.asp"> This ancient MSDN article from the Windows 3.1 SDK</a> describes the flag thus:</p>
<blockquote class="q"><p> ES_OEMCONVERT causes text entered into the edit control to be converted from ANSI to OEM and then back to ANSI. This ensures proper character conversion when the application calls the <b>AnsiToOem</b> function to convert a Windows string in the edit control to OEM characters. ES_OEMCONVERT is most useful for edit controls that contain filenames. </p></blockquote>
<p> Set the wayback machine to, well, January 31, 1992, the date of the article. </p>
<p> At this time, the predominant Windows platform was Windows 3.0. Windows 3.1 was still a few months away from release, and Windows NT 3.1 was over a year away. The predominant file system was 16-bit FAT, and the relevant feature of FAT of this era for the purpose of this discussion is that file names were stored on disk in the OEM character set. (We discussed <a href="http://blogs.msdn.com/oldnewthing/archive/2005/03/08/389527.aspx"> the history behind the schism between the OEM and ANSI code pages</a> in an earlier article.) </p>
<p> Since GUI programs used the ANSI character set, but file names were stored in the OEM character set, the only characters that could be used in file names from GUI programs were those that exist in both character sets. If a character existed in the ANSI character set but not the OEM character set, then there would be no way of using it as a file name; and if a character existed in the OEM character set but not the ANSI character set, the GUI program couldn’t manipulate it. </p>
<p> The <code>ES_OEMCONVERT</code> flag on a edit control ensures that only characters that exist in both the ANSI and OEM character sets are used, hence the remark “ES_OEMCONVERT is most useful for edit controls that contain filenames”. </p>
<p> Fast-forward to today. </p>
<p> All the popular Windows file systems support Unicode file names and have for ten years. There is no longer a data loss converting from the ANSI character set to the character set used by the file system. Therefore, there is no need to filter out any characters to forestall the user typing a character that will be lost during the conversion to a file name. In other words, the <code>ES_OEMCONVERT</code> flag is pointless today. It’s a leftover from the days before Unicode. </p>
<p> Indeed, if you use this flag, you make your program worse, not better, because it unnecessarily restricts the set of characters that the user will be allowed to use in file names. A user running the US-English version of Windows would not be allowed to enter Chinese characters as a file name, for example, even though the file system is perfectly capable of creating files whose names contain those characters. </p>


</body>